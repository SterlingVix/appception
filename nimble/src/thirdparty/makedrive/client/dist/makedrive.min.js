/*! makedrive 0.0.39 2014-09-11 */
!function(a){if("object"==typeof exports&&"undefined"!=typeof module)module.exports=a();else if("function"==typeof define&&define.amd)define([],a);else{var b;"undefined"!=typeof window?b=window:"undefined"!=typeof global?b=global:"undefined"!=typeof self&&(b=self),b.MakeDrive=a()}}(function(){var a;return function b(a,c,d){function e(g,h){if(!c[g]){if(!a[g]){var i="function"==typeof require&&require;if(!h&&i)return i(g,!0);if(f)return f(g,!0);var j=new Error("Cannot find module '"+g+"'");throw j.code="MODULE_NOT_FOUND",j}var k=c[g]={exports:{}};a[g][0].call(k.exports,function(b){var c=a[g][1][b];return e(c?c:b)},k,k.exports,b,a,c,d)}return c[g].exports}for(var f="function"==typeof require&&require,g=0;g<d.length;g++)e(d[g]);return e}({1:[function(a,b){(function(a){a.WebSocket.prototype.on=a.WebSocket.prototype.on||function(a,b){this.addEventListener(a,b)},a.WebSocket.prototype.removeListener=a.WebSocket.prototype.removeListener||function(a,b){this.removeEventListener(a,b)},a.WebSocket.prototype.once=a.WebSocket.prototype.once||function(a,b){var c=this;this.addEventListener(a,function d(){c.removeEventListener(a,d),b.apply(null,arguments)})},b.exports=a.WebSocket}).call(this,"undefined"!=typeof global?global:"undefined"!=typeof self?self:"undefined"!=typeof window?window:{})},{}],2:[function(a,b){(function(c){function d(a){function b(b){if(a.windowCloseWarning&&p.state===p.SYNC_SYNCING){var d="Sync currently underway, are you sure you want to close?";return(b||c.event).returnValue=d,d}}function d(){k&&(k.close(),k=null)}a.manual=a.manual===!0,a.memory=a.memory===!0;var j;j=a.provider?a.provider:a.memory?new g.FileSystem.providers.Memory("makedrive"):new g.FileSystem.providers.Fallback("makedrive");var k,l,m,n=new g.FileSystem({provider:j}),o=new f(n),p=o.sync=new h;return p.SYNC_DISCONNECTED="SYNC DISCONNECTED",p.SYNC_CONNECTING="SYNC CONNECTING",p.SYNC_CONNECTED="SYNC CONNECTED",p.SYNC_SYNCING="SYNC SYNCING",p.SYNC_ERROR="SYNC ERROR",p.state=p.SYNC_DISCONNECTED,p.auto=function(a){var b=a|!1?0|a:6e4;l&&clearInterval(l),l=setInterval(p.request,b)},p.manual=function(){l&&(clearInterval(l),l=null)},p.onError=function(a){o.pathToSync=m,p.state=p.SYNC_ERROR,p.emit("error",a)},p.onDisconnected=function(){"onbeforeunload"in c&&c.removeEventListener("beforeunload",b),"onunload"in c&&c.removeEventListener("unload",d),p.state=p.SYNC_DISCONNECTED,p.emit("disconnected")},p.request=function(){return p.state===p.SYNC_DISCONNECTED||p.state===p.SYNC_ERROR?void p.emit("error",new Error("Invalid state. Expected "+p.SYNC_CONNECTED+", got "+p.state)):void(o.pathToSync&&(m=o.pathToSync,o.pathToSync=null,k.syncPath(m)))},p.connect=function(f,g){function h(){p.onSyncing=function(){p.state=p.SYNC_SYNCING,p.emit("syncing")},p.onCompleted=function(a){function b(){p.state=p.SYNC_CONNECTED,p.emit("completed")}return a?void k.resetUnsynced(a,function(a){return a?p.onError(a):void b()}):b()},p.state=p.SYNC_CONNECTED,a.manual?p.manual():p.auto(a.interval),"onbeforeunload"in c&&c.addEventListener("beforeunload",b),"onunload"in c&&c.addEventListener("unload",d),p.emit("connected")}function j(a){k=new e(p,n),k.init(f,a,function(a){return a?void p.onError(a):(p.onSyncing=function(){},void(p.onCompleted=function(){h()}))})}if(p.state!==p.SYNC_DISCONNECTED&&p.state!==p.ERROR)return void p.emit("error",new Error('MakeDrive: Attempted to connect to "'+f+'", but a connection already exists!'));if(!k)if(p.state=p.SYNC_CONNECTING,g)j(g);else{var l=f.replace(/^([^\/]*\/\/)?/,function(a,b){return"wss://"===b?"https://":"http://"});l=l.replace(/\/?$/,"/api/sync"),i({url:l,method:"GET",json:!0,withCredentials:!0},function(a,b,c){var d,e;d=b&&b.statusCode,e=200!==d?{message:a||"Unable to get token",code:d}:null,e?p.onError(e):j(c)})}},p.disconnect=function(){return p.state===p.SYNC_DISCONNECTED||p.state===p.ERROR?void p.emit("error",new Error("MakeDrive: Attempted to disconnect, but no server connection exists!")):(l&&(clearInterval(l),l=null,o.pathToSync=null),d(),void p.onDisconnected())},o}var e=a("./sync-manager.js"),f=a("./sync-filesystem.js"),g=a("../../lib/filer.js"),h=(a("../../lib/sync-path-resolver").resolve,a("events").EventEmitter),i=a("request"),j={};b.exports=j;var k;j.fs=function(a){return a=a||{},a.forceCreate?d(a):(k||(k=d(a)),k)},j.Buffer=g.Buffer,j.Path=g.Path,j.Errors=g.Errors}).call(this,"undefined"!=typeof global?global:"undefined"!=typeof self?self:"undefined"!=typeof window?window:{})},{"../../lib/filer.js":13,"../../lib/sync-path-resolver":17,"./sync-filesystem.js":4,"./sync-manager.js":5,events:23,request:22}],3:[function(a,b){function c(a,b){a.session.step=o.FAILED,a.sync.onError(b)}function d(a,b){return a===b?!0:"/"===b?!1:d(a,p(b))}function e(a,b){function d(){var d=h.srcList=b.content.srcList;h.path=b.content.path,f.modifiedPath=null,g.onSyncing(),j.checksums(f,h.path,d,k,function(b,d){if(b)return c(a,b);h.step=o.PATCH;var e=i.request.diffs;e.content={checksums:d},m.send(e.stringify())})}function e(){j.diff(f,h.path,b.content.checksums,k,function(b,d){if(b)return c(a,b);h.step=o.PATCH;var e=i.response.diffs;e.content={diffs:l(d)},m.send(e.stringify())})}var f=a.fs,g=a.sync,h=a.session,m=a.socket;b.is.chksum&&h.is.ready&&(h.is.synced||h.is.failed)?d():b.is.diffs&&h.is.syncing&&h.is.diffs?e():c(a,new Error("Failed to sync with the server. Current step is: "+h.step+". Current state is: "+h.state))}function f(a,b){function e(){return s.srcList?void j.checksums(q,s.path,s.srcList,k,function(b,d){if(b)return t.send(i.response.reset.stringify()),c(a,b);var e=i.request.diffs;e.content={checksums:d},t.send(e.stringify())}):(s.step=o.FAILED,t.send(i.response.reset.stringify()),c(a,new Error("Fatal Error: Could not sync filesystem from server...trying again!")))}function f(){s.state=n.SYNCING,s.step=o.INIT,s.path=b.content.path,r.onSyncing(),j.sourceList(q,s.path,k,function(b,d){if(b)return t.send(i.request.reset.stringify()),c(a,b);s.step=o.DIFFS;var e=i.request.chksum;e.content={srcList:d},t.send(e.stringify())})}function g(){s.state=n.READY,s.step=o.SYNCED,r.onCompleted(b.content.syncedPaths)}function h(){var f=q.modifiedPath;if(q.modifiedPath=null,f&&d(s.path,f))return e();var g=b.content.diffs;g=m(g),j.patch(q,s.path,g,k,function(b,d){if(b){var e=i.response.reset;return t.send(e.stringify()),c(a,b)}var f=k.size||5;j.pathChecksums(q,d.synced,f,function(b,d){if(b){var e=i.response.reset;return t.send(e.stringify()),c(a,b)}var e=i.response.patch;e.content={checksums:d,size:f},t.send(e.stringify())})})}function l(){s.srcList=null,s.step=o.SYNCED,r.onCompleted()}function p(){var a=i.request.sync;a.content={path:s.path},t.send(a.stringify())}var q=a.fs,r=a.sync,s=a.session,t=a.socket;b.is.sync?f():b.is.patch&&s.is.syncing&&s.is.patch?g():b.is.diffs&&s.is.ready&&s.is.patch?h():b.is.verification&&s.is.ready&&s.is.patch?l():b.is.reset&&s.is.failed?p():c(a,new Error("Failed to sync with the server. Current step is: "+s.step+". Current state is: "+s.state))}function g(a,b){var d=(a.sync,a.session),e=a.socket,f=i.response.reset;if(b.is.srclist&&d.is.synced||b.is.diffs&&d.is.patch&&(d.is.ready||d.is.syncing))d.state=n.READY,d.step=o.SYNCED,e.send(f.stringify()),c(a,new Error("Could not sync filesystem from server... trying again"));else if(b.is.verification&&d.is.patch&&d.is.ready)e.send(f.stringify()),c(a,new Error("Could not sync filesystem from server... trying again"));else if(b.is.locked&&d.is.ready&&d.is.synced)c(a,new Error("Current sync in progress! Try again later!"));else if((b.is.chksum&&d.is.diffs||b.is.patch&&d.is.patch)&&d.is.syncing){var f=i.request.reset;e.send(f.stringify()),c(a,new Error("Could not sync filesystem from server... trying again"))}else c(a,new Error("Failed to sync with the server. Current step is: "+d.step+". Current state is: "+d.state))}function h(a,b){try{b=JSON.parse(b),b=i.parse(b)}catch(d){return c(a,d)}b.is.request?e(a,b):b.is.response?f(a,b):b.is.error?g(a,b):c(a,new Error("Cannot handle message"))}var i=a("../../lib/syncmessage"),j=a("../../lib/rsync"),k=a("../../lib/constants").rsyncDefaults,l=a("../../lib/diff").serialize,m=a("../../lib/diff").deserialize,n=a("./sync-states"),o=a("./sync-steps"),p=a("../../lib/filer").Path.dirname;b.exports=h},{"../../lib/constants":10,"../../lib/diff":11,"../../lib/filer":13,"../../lib/rsync":16,"../../lib/syncmessage":18,"./sync-states":6,"./sync-steps":7}],4:[function(a,b){function c(a){function b(b,c){g.fsetUnsynced(a,b,c)}function c(b,c){g.setUnsynced(a,b,c)}function d(b,c,d,e){return function(){var g=Array.prototype.slice.call(arguments,0),h=g.length-1,i=g[h],j=g[c];j=e?f.dirname(j):j,a.openFiles[j]||(l.pathToSync=j,a.modifiedPath=j),g[h]=function(){var a=Array.prototype.slice.call(arguments,0);return a[0]?i(a[0]):void d(j,function(b){return b?i(b):void i.apply(null,a)})},a[b].apply(a,g)}}var j,k,l=this;Object.defineProperty(l,"pathToSync",{get:function(){return j},set:function(a){j=a?i(j,a):null}}),Object.defineProperty(a,"modifiedPath",{get:function(){return k},set:function(a){k=a?i(k,a):null}}),["stat","fstat","lstat","exists","readlink","realpath","readdir","open","close","fsync","read","readFile","setxattr","fsetxattr","getxattr","fgetxattr","removexattr","fremovexattr","watch"].forEach(function(b){l[b]=function(){a[b].apply(a,arguments)}}),["truncate","mknod","mkdir","utimes","writeFile","appendFile"].forEach(function(a){l[a]=d(a,0,c)}),["link","symlink"].forEach(function(a){l[a]=d(a,1,c)}),["rename"].forEach(function(a){l[a]=d(a,1,c,!0)}),["ftruncate","futimes","write"].forEach(function(a){l[a]=d(a,0,b)}),["rmdir","unlink"].forEach(function(a){l[a]=d(a,0,c,!0)});var m=l.rename;l.rename=function(b,c,d){m(b,c,function(b){return b?d(b):void h.isConflictedCopy(a,c,function(b,e){return b?d(b):void(e?h.removeFileConflict(a,c,d):d())})})},l.Shell=function(a){return new e(l,a)},l.getUnsynced=function(b,c){g.getUnsynced(a,b,c)},l.fgetUnsynced=function(b,c){g.fgetUnsynced(a,b,c)}}var d=a("../../lib/filer.js"),e=a("../../lib/filer-shell.js"),f=d.Path,g=a("../../lib/fs-utils.js"),h=a("../../lib/conflict.js"),i=(a("../../lib/constants.js"),a("../../lib/sync-path-resolver.js").resolve);b.exports=c},{"../../lib/conflict.js":9,"../../lib/constants.js":10,"../../lib/filer-shell.js":12,"../../lib/filer.js":13,"../../lib/fs-utils.js":14,"../../lib/sync-path-resolver.js":17}],5:[function(a,b){function c(a,b){var c=this;c.sync=a,c.fs=b,c.session={state:f.CLOSED,step:g.SYNCED,path:"/",is:Object.create(Object.prototype,{syncing:{get:function(){return c.session.state===f.SYNCING}},ready:{get:function(){return c.session.state===f.READY}},error:{get:function(){return c.session.state===f.ERROR}},closed:{get:function(){return c.session.state===f.CLOSED}},init:{get:function(){return c.session.step===g.INIT}},chksum:{get:function(){return c.session.step===g.CHKSUM}},diffs:{get:function(){return c.session.step===g.DIFFS}},patch:{get:function(){return c.session.step===g.PATCH}},synced:{get:function(){return c.session.step===g.SYNCED}},failed:{get:function(){return c.session.step===g.FAILED}}})}}var d=a("../../lib/syncmessage"),e=a("./message-handler"),f=a("./sync-states"),g=a("./sync-steps"),h=a("ws"),i=a("../../lib/fs-utils"),j=a("../../lib/async-lite.js");c.prototype.init=function(a,b,c){function i(a){var b=a.data||a;try{b=JSON.parse(b),b=d.parse(b)}catch(h){return c(h)}b.is.response&&b.is.authz?(l.state=f.READY,l.step=g.SYNCED,n.onmessage=function(a){var b=a.data||a;e(k,b)},n.send(d.response.authz.stringify()),c()):c(new Error("Cannot handle message"))}function j(a){var b=a.reason||"WebSocket closed unexpectedly",c=new Error(a.code+": "+b);k.close(),k.socket=null,m.onError(c),m.onDisconnected()}var k=this,l=k.session,m=k.sync,n=k.socket=new h(a);n.onmessage=i,n.onclose=j,n.onopen=function(){n.send(JSON.stringify({token:b}))}},c.prototype.syncPath=function(a){var b,c=this;if(!c.socket)throw new Error("sync called before init");b=d.request.sync,b.content={path:a},c.socket.send(b.stringify())},c.prototype.resetUnsynced=function(a,b){function c(a,b){i.removeUnsynced(d,a,function(a){return a&&"ENOENT"!==a.code?b(a):void b()})}var d=this.fs;j.eachSeries(a,c,function(a){return a?b(a):void b()})},c.prototype.close=function(){var a=this,b=a.socket;b&&(b.onmessage=function(){},b.onopen=function(){},1===b.readyState?(b.onclose=function(){a.socket=null},b.close()):a.socket=null)},b.exports=c},{"../../lib/async-lite.js":8,"../../lib/fs-utils":14,"../../lib/syncmessage":18,"./message-handler":3,"./sync-states":6,"./sync-steps":7,ws:1}],6:[function(a,b){b.exports={SYNCING:"SYNC IN PROGRESS",READY:"READY",ERROR:"ERROR",CLOSED:"CLOSED"}},{}],7:[function(a,b){b.exports={INIT:"SYNC INITIALIZED",CHKSUM:"CHECKSUM",DIFFS:"DIFFS",PATCH:"PATCH",SYNCED:"SYNCED",FAILED:"FAILED"}},{}],8:[function(a,b){b.exports=a("../node_modules/filer/lib/async.js")},{"../node_modules/filer/lib/async.js":24}],9:[function(a,b){function c(a,b,c){var d=i.dirname(b),e=i.basename(b),f=i.extname(b),g=new Date,h=g.getFullYear()+"-"+g.getMonth()+"-"+g.getDay()+" "+g.getHours()+":"+g.getMinutes()+":"+g.getSeconds(),j=" (Conflicted Copy "+h+")",l=i.join(d,e+j+f);k.forceCopy(a,b,l,function(a){return a?c(a):void c(null,l)})}function d(a){return/\(Conflicted Copy \d{4}-\d{1,2}-\d{1,2} \d{1,2}:\d{1,2}:\d{1,2}\)/.test(a)}function e(a,b,c){a.getxattr(b,j.attributes.conflict,function(a,b){return a&&"ENOATTR"!==a.code?c(a):void c(null,!!b)})}function f(a,b,d){a.lstat(b,function(e,f){return e?d(e):f.isDirectory()?d(new h.Errors.EISDIR("conflict not permitted on directory")):void c(a,b,function(b,c){return b?d(b):void a.setxattr(c,j.attributes.conflict,!0,function(a){return a?d(a):void d(null,c)})})})}function g(a,b,c){a.removexattr(b,j.attributes.conflict,function(a){return a&&"ENOATTR"!==a.code?c(a):void c()})}var h=a("./filer.js"),i=h.Path,j=a("./constants.js"),k=a("./fs-utils.js");b.exports={filenameContainsConflicted:d,isConflictedCopy:e,makeConflictedCopy:f,removeFileConflict:g}},{"./constants.js":10,"./filer.js":13,"./fs-utils.js":14}],10:[function(a,b){b.exports={rsyncDefaults:{size:5,time:!0,recursive:!0},attributes:{unsynced:"makedrive-unsynced",conflict:"makedrive-conflict"}}},{}],11:[function(a,b){function c(a,b){return a.contents?a.contents=a.contents.map(function(a){return c(a,b)}):a.diffs=a.diffs.map(function(a){return a.data=b(a.data),a}),a}function d(a){if(!g.isBuffer(a))return a;var b=a.toJSON();return b.data||b}function e(a){return new g(a)}function f(a,b){return a.length?a.map(function(a){return c(a,b)}):a}var g=a("./filer.js").Buffer;b.exports.serialize=function(a){return f(a,d)},b.exports.deserialize=function(a){return f(a,e)}},{"./filer.js":13}],12:[function(a,b){b.exports=a("../node_modules/filer/src/shell/shell.js")},{"../node_modules/filer/src/shell/shell.js":47}],13:[function(a,b){b.exports=a("filer")},{filer:37}],14:[function(a,b){function c(a,b,c,d){a.unlink(c,function(e){return e&&"ENOENT"!==e.code?d(e):void a.readFile(b,function(b,e){return b?d(b):void a.writeFile(c,e,d)})})}function d(a,b,c){a.getxattr(b,k.attributes.unsynced,function(a,b){return a&&"ENOENT"===a.code?c(null,!1):a&&"ENOATTR"!==a.code?c(a):void c(null,!!b)})}function e(a,b,c){a.removexattr(b,k.attributes.unsynced,function(a){return a&&"ENOATTR"!==a.code?c(a):void c()})}function f(a,b,c){a.fremovexattr(b,k.attributes.unsynced,function(a){return a&&"ENOATTR"!==a.code?c(a):void c()})}function g(a,b,c){a.setxattr(b,k.attributes.unsynced,Date.now(),function(a){return a?c(a):void c()})}function h(a,b,c){a.fsetxattr(b,k.attributes.unsynced,Date.now(),function(a){return a?c(a):void c()})}function i(a,b,c){a.getxattr(b,k.attributes.unsynced,function(a,b){return a&&"ENOATTR"!==a.code?c(a):void c(null,b)})}function j(a,b,c){a.fgetxattr(b,k.attributes.unsynced,function(a,b){return a&&"ENOATTR"!==a.code?c(a):void c(null,b)})}var k=a("./constants.js");b.exports={forceCopy:c,isPathUnsynced:d,removeUnsynced:e,fremoveUnsynced:f,setUnsynced:g,fsetUnsynced:h,getUnsynced:i,fgetUnsynced:j}},{"./constants.js":10}],15:[function(a,b){b.exports={difference:function(a,b){return a.filter(function(a){return-1===b.indexOf(a)})},sortBy:function(a,b){return a.sort(function(a,c){return a=a[b],c=c[b],a===c?0:c>a?-1:1})},isArray:Array.isArray||function(a){return"[object Array]"===toString.call(a)},map:function(a,b){return this.isArray(a)?a.map(b):Object.keys(a).map(function(c){return b(a[c])})},values:function(a){return Object.keys(a).map(function(b){return a[b]})}}},{}],16:[function(a,b){function c(a){return a&&"function"!=typeof a||(a={}),a.size=a.size||512,a.checksum="checksum"in a?a.checksum:!0,a.recursive=a.recursive||!1,a.time=a.time||!1,a.links=a.links||!1,a}function d(a,b){return a||"function"!=typeof b||(a=b),a}function e(a,b){return a?b?null:new r.EINVAL("Path must be specified"):new r.EINVAL("No filesystem provided")}function f(a,b){return p.basename(a)===b?p.dirname(a):a}function g(a){return t(a).toString()}function h(a,b,c,d){var e=0,f=0,g=65536,h=65521;if(b){var i=c,j=d-1,k=i-1,l=j-1,m=a[k],n=(a[l],a[i],a[j]);e=(b.a-m+n)%h,f=(b.b-(l-k+1)*m+e)%h}else{for(var o,p=c>=0&&d>=0?d-c+1:a.length,q=0;p>q;q++)o=a[q],e+=o,f+=(p-q)*o;e%=h,f%=h}return{a:e,b:f,sum:e+f*g}}function i(a){return 65535&(a>>16^1009*a)}function j(a){for(var b,c,d={},e=a.length,f=0;e>f;f++)b=a[f],c=i(b.weak),d[c]?d[c].push(b):d[c]=[b];return d}function k(a,b,c){for(var d,e,f,k,l,m,n,o,p,q,r=[],s=j(b),t=a.length,u=0,v=c>t?t:c,w=0,x=null;t>=v;u++,v++){if(d=h(a,x,u,v),e=i(d.sum),f=!1,k=null,x=d,p=s[e]){l=p.length;for(var y=0;l>y;y++)if(q=p[y],q.weak===d.sum&&(m=q,n=a.slice(u,v),o=g(n),m.strong===o)){f=m;break}}f?(w>u?(k=a.slice(w-1,v),r.push({data:k,index:f.index})):u-w>0?(k=a.slice(w,u),r.push({data:k,index:f.index})):r.push({index:f.index}),w=v):v===t&&(k=a.slice(w),r.push({data:k}))}return r}function l(a,b,c,d){var e={};a.readFile(b,function(a,f){if(a){if(!a||"ENOENT"!==a.code)return d(a);e[b]=[]}else e[b]=f;for(var i,j,k,l=e[b].length,m=c,n=0,o=m>l?l:m,p=0,q=[];l>n;)i=e[b].slice(n,o),j=h(i).sum,k=g(i),q.push({index:p,weak:j,strong:k}),n+=m,o=o+m>l?l:o+m,p++;d(null,q)})}function m(a,b){function c(b){var c=f(a,b.path),e=p.join(c,b.path);if(b.identical||d.push(e),b.contents){var g=m(e,b.contents);d=d.concat(g)}}var d=[];return b.forEach(c),d}var n=a("./filer.js"),o=n.Buffer,p=n.Path,q=a("./fs-utils.js"),r=n.Errors,s=a("./async-lite.js"),t=a("MD5"),u={},v=(a("./constants.js"),a("./conflict.js")),w=a("./lodash-lite.js");u.sourceList=function x(a,b,f,g){g=d(g,f);var h=e(a,b);if(h)return g(h);f=c(f);var i=[];a.lstat(b,function(c,d){return c?g(c):d.isDirectory()?void a.readdir(b,function(c,d){function e(c,d){var e=p.join(b,c);a.lstat(e,function(b,c){if(b)return d(b);var g={path:p.basename(e),modified:c.mtime,size:c.size,type:c.type};f.recursive&&c.isDirectory()?x(a,e,f,function(a,b){return a?d(a):(g.contents=b,i.push(g),void d())}):v.isConflictedCopy(a,e,function(a,b){return a?d(a):(b||i.push(g),void d())})})}return c?g(c):void s.eachSeries(d,e,function(a){return a?g(a):void g(null,i)})}):void v.isConflictedCopy(a,b,function(a,c){if(a)return g(a);if(!c){var e={path:p.basename(b),size:d.size,type:d.type,modified:d.mtime};i.push(e)}g(null,i)})})},u.checksums=function(a,b,g,h,i){function j(c,d,e){var f=p.join(b,d.path);a.mkdir(f,function(b){return b&&"EEXIST"!==b.code?e(b):void u.checksums(a,f,d.contents,h,function(a,b){return a?e(a):(c.contents=b||[],q.push(c),void e())})})}function k(b,c,d,e,f){!h.checksum||h.recursive?a.stat(e,function(d,g){return d&&"ENOENT"!==d.code?f(d):void(g&&g.mtime===c.modified&&g.size===c.size?(b.checksums=[],b.modified=c.modified,b.identical=!0,q.push(b),f()):l(a,e,h.size,function(a,d){return a?f(a):(b.checksums=d,b.modified=c.modified,q.push(b),void f())}))}):l(a,e,h.size,function(a,d){return a?f(a):(b.checksums=d,b.modified=c.modified,q.push(b),void f())})}function m(b,c,d,e,f){b.link=!0,!h.checksum||h.recursive?a.stat(e,function(a,d){return a&&"ENOENT"!==a.code?f(a):(d&&d.mtime===c.modified&&d.size===c.size&&(b.identical=!0),q.push(b),void f())}):(q.push(b),f())}function n(c,d){var e={path:c.path},g=f(b,c.path),i=p.join(g,c.path);a.Shell().mkdirp(g,function(a){return a&&"EEXIST"!==a.code?d(a):void(h.recursive&&"DIRECTORY"===c.type?j(e,c,d):"FILE"!==c.type&&h.links?"SYMLINK"===c.type&&m(e,c,g,i,d):k(e,c,g,i,d))})}i=d(i,h);var o=e(a,b);if(o)return i(o);h=c(h);var q=[];s.eachSeries(g,n,function(a){a?i(a):i(null,q)})},u.diff=function(a,b,f,g,h){function i(c,d){var e=p.join(b,c.path);c.contents?u.diff(a,e,c.contents,g,function(a,b){return a?d(a):(l.push({path:c.path,contents:b}),void d())}):c.link?a.readlink(e,function(b,f){return b?d(b):void a.lstat(e,function(a,b){return a?d(a):(l.push({link:f,modified:b.mtime,path:c.path}),void d(null,l))})}):c.identical?(l.push({diffs:[],modified:c.modified,path:c.path,identical:!0}),d(null,l)):a.readFile(e,function(a,b){return a?d(a):(l.push({diffs:k(b,c.checksums,g.size),modified:c.modified,path:c.path}),void d(null,l))})}h=d(h,g);var j=e(a,b);if(j)return h(j);if(g=c(g),g.checksum&&!f)return h(new r.EINVAL("Checksums must be provided"));var l=[];a.lstat(b,function(c,d){if(c)return h(c);if(d.isDirectory())s.eachSeries(f,i,function(a){return a?h(a):void h(null,l)});else if(d.isFile()||!g.links){if(f[0].identical)return l.push({diffs:[],modified:f[0].modified,path:f[0].path,identical:!0}),h(null,l);a.readFile(b,function(a,b){return a?h(a):(l.push({diffs:k(b,f[0].checksums,g.size),modified:f[0].modified,path:f[0].path}),void h(null,l))})}else d.isSymbolicLink()&&a.readlink(b,function(c,d){return c?h(c):void a.lstat(b,function(a,b){return a?h(a):(l.push({link:d,modified:b.mtime,path:f[0].path}),void h(null,l))})})})},u.patch=function(a,b,g,h,i){function j(a,b){var c=w.difference(x,t.synced);t.failed=t.failed.concat(c),b(a,t)}function k(b,c,d){"function"==typeof c&&(d=c,c=null),a.readdir(b,function(e,f){function g(c,d){var e=p.join(b,c);q.isPathUnsynced(a,e,function(b,c){return b?j(b,d):c?d():(t.synced.push(e),void a.unlink(e,d))})}if(e)return j(e,d);var h=f;if(c){var i=c.map(function(a){return a.path});h=w.difference(f,i)}s.eachSeries(h,g,function(a){return a?d(a,t):void d(null,t)})})}function l(c,d){var e=f(b,c.path),g=p.join(e,c.path);return c.contents?u.patch(a,p.join(b,c.path),c.contents,h,function(a,e){return a?(t.update(e),j(a,d)):(t.synced.push(g),t.update(e),void k(p.join(b,c.path),c.contents,d))}):c.link?a.symlink(c.link,g,function(a){return a?j(a,d):(t.synced.push(g),void d(null,t))}):c.identical?d(null,t):void a.readFile(g,function(b,e){function f(a){var b=a*h.size,c=b+h.size>i.length?i.length:b+h.size;return i.slice(b,c)}var i;if(b){if("ENOENT"!==b.code)return j(b,d);i=new o(0)}else i=e;for(var k=c.diffs.length,l=[],m=0;k>m;m++){var n=c.diffs[m];n.data?(l.push(n.data),n.index&&l.push(f(n.index))):l.push(f(n.index))}q.isPathUnsynced(a,g,function(b,e){function f(){var b=o.concat(l);a.writeFile(g,b,function(b){return b?j(b,d):h.time?void a.utimes(g,c.modified,c.modified,function(a){return a?j(a,d):(t.synced.push(g),void d(null,t))}):(t.synced.push(g),d(null,t))})}return b?j(b,d):void(e?v.makeConflictedCopy(a,g,function(b){return b?j(b,d):void q.removeUnsynced(a,g,function(a){return a?j(a,d):void f()})}):f())})})}function n(c,e){e=d(e,c),a.lstat(b,function(a,d){return a?j(a,e):d.isDirectory()?void k(b,c,e):e(null,t)})}i=d(i,h);var r=e(a,b),t={synced:[],failed:[],update:function(a){this.synced=this.synced.concat(a.synced),this.failed=this.failed.concat(a.failed)}},x=m(b,g);return r?i(r,t):(h=c(h),void(g&&g.length?s.eachSeries(g,l,function(a){a?i(a,t):n(g,i)}):a.Shell().mkdirp(b,function(a){a&&"EEXIST"!==a?i(a,t):n(i)})))},u.pathChecksums=function(a,b,c,d){function f(b,d){var e={path:b};a.lstat(b,function(f,g){return f?"ENOENT"!==f.code?d(f):(e.checksum=[],h.push(e),d()):g.isDirectory()?a.readdir(b,function(a,b){return a?d(a):(e.contents=b,h.push(e),void d())}):void l(a,b,c,function(a,b){return a?d(a):(e.checksum=b,h.push(e),void d())})})}var g=e(a,b),h=[];return c&&"function"==typeof d?g?d(g):void s.eachSeries(b,f,function(a){return a?d(a):void d(null,h)}):d(new r.EINVAL("Insufficient data provided"))},u.compareContents=function(a,b,c,d){function f(a,b){var c,d,e=b.length;if(a.length!==e)return!1;a=w.map(w.sortBy(a,"index"),w.values),b=w.map(w.sortBy(b,"index"),w.values);for(var f=0;e>f;f++)if(c=a[f],d=b[f],c[1]!==d[1]||c[2]!==d[2])return!1;return!0}function g(b,d){var e=b.path;a.lstat(e,function(g,i){return g?"ENOENT"!==g.code?d(g):b.checksum&&!b.checksum.length?d():d(h):i.isDirectory()?a.readdir(e,function(a,c){return a?d(a):!b.contents||w.difference(b.contents,c).length?d(h):void d()}):b.checksum?void l(a,e,c,function(a,c){return a?d(a):f(c,b.checksum)?void d():d(h)}):d(h)})}var h="DIFF",i=e(a,b);return c&&"function"==typeof d?i?d(i):void s.eachSeries(b,g,function(a){return a&&a!==h?d(a,!1):a===h?d(null,!1):void d(null,!0)}):d(new r.EINVAL("Insufficient data provided"))},b.exports=u},{"./async-lite.js":8,"./conflict.js":9,"./constants.js":10,"./filer.js":13,"./fs-utils.js":14,"./lodash-lite.js":15,MD5:19}],17:[function(a,b){function c(a){return"/"===a?0:1+c(f(a))}function d(a,b,c,e){return a===c?a:(b===e?(a=f(a),b--,c=f(c),e--):b>e?(a=f(a),b--):(c=f(c),e--),d(a,b,c,e))}var e={},f=a("./filer").Path.dirname;e.resolve=function(a,b){if(!a&&!b)return"/";if(!a||!b)return a||b;var e=c(a),f=c(b);return d(a,e,b,f)},b.exports=e},{"./filer":13}],18:[function(a,b){function c(a,b,f){if(!e(a))throw"Invalid type";if(!d(b))throw"Invalid name";this.type=a,this.name=b,this.content=f||null;var g=this;this.is={get request(){return g.type===c.REQUEST},get response(){return g.type===c.RESPONSE},get error(){return g.type===c.ERROR},get srclist(){return g.name===c.SRCLIST},get sync(){return g.name===c.SYNC},get chksum(){return g.name===c.CHKSUM},get diffs(){return g.name===c.DIFFS},get patch(){return g.name===c.PATCH},get verification(){return g.name===c.VERIFICATION},get reset(){return g.name===c.RESET},get locked(){return g.name===c.LOCKED},get authz(){return g.name===c.AUTHZ},get impl(){return g.name===c.IMPL},get serverReset(){return g.name===c.SERVER_RESET},get downstreamLocked(){return g.name===c.DOWNSTREAM_LOCKED}}}function d(a){return a===c.SRCLIST||a===c.CHKSUM||a===c.DIFFS||a===c.LOCKED||a===c.PATCH||a===c.VERIFICATION||a===c.SYNC||a===c.RESET||a===c.AUTHZ||a===c.IMPL||a===c.INFRMT||a===c.INCONT||a===c.SERVER_RESET||a===c.DOWNSTREAM_LOCKED}function e(a){return a===c.REQUEST||a===c.RESPONSE||a===c.ERROR}c.prototype.stringify=function(){return JSON.stringify({type:this.type,name:this.name,content:this.content})},c.parse=function(a){return a&&e(a.type)&&d(a.name)?new c(a.type,a.name,a.content):c.error.format},c.REQUEST="REQUEST",c.RESPONSE="RESPONSE",c.ERROR="ERROR",c.SRCLIST="SRCLIST",c.SYNC="SYNC",c.CHKSUM="CHKSUM",c.DIFFS="DIFFS",c.PATCH="PATCH",c.VERIFICATION="VERIFICATION",c.RESET="RESET",c.LOCKED="LOCKED",c.AUTHZ="AUTHORIZED",c.IMPL="IMPLEMENTATION",c.SERVER_RESET="SERVER_RESET",c.DOWNSTREAM_LOCKED="DOWNSTREAM_LOCKED",c.INFRMT="INVALID FORMAT",c.INCONT="INVALID CONTENT",c.request={get diffs(){return new c(c.REQUEST,c.DIFFS)},get chksum(){return new c(c.REQUEST,c.CHKSUM)},get sync(){return new c(c.REQUEST,c.SYNC)},get reset(){return new c(c.REQUEST,c.RESET)}},c.response={get diffs(){return new c(c.RESPONSE,c.DIFFS)},get patch(){return new c(c.RESPONSE,c.PATCH)},get verification(){return new c(c.RESPONSE,c.VERIFICATION)},get authz(){return new c(c.RESPONSE,c.AUTHZ)},get sync(){return new c(c.RESPONSE,c.SYNC)},get reset(){return new c(c.RESPONSE,c.RESET)}},c.error={get srclist(){return new c(c.ERROR,c.SRCLIST)},get diffs(){return new c(c.ERROR,c.DIFFS)},get locked(){return new c(c.ERROR,c.LOCKED)},get chksum(){return new c(c.ERROR,c.CHKSUM)},get patch(){return new c(c.ERROR,c.PATCH)},get impl(){return new c(c.ERROR,c.IMPL)},get serverReset(){return new c(c.ERROR,c.SERVER_RESET)},get downstreamLocked(){return new c(c.ERROR,c.DOWNSTREAM_LOCKED,"Downstream syncs are locked!")},get verification(){return new c(c.ERROR,c.VERIFICATION,"Patch could not be verified")},get format(){return new c(c.ERROR,c.INFRMT,"Message must be formatted as a sync message")},get content(){return new c(c.ERROR,c.INCONT,"Invalid content provided")}},b.exports=c},{}],19:[function(a,b){(function(c){!function(){var d=a("crypt"),e=a("charenc").utf8,f=a("charenc").bin,g=function(a,b){a.constructor==String?a=b&&"binary"===b.encoding?f.stringToBytes(a):e.stringToBytes(a):"undefined"!=typeof c&&"function"==typeof c.isBuffer&&c.isBuffer(a)?a=Array.prototype.slice.call(a,0):Array.isArray(a)||(a=a.toString());for(var h=d.bytesToWords(a),i=8*a.length,j=1732584193,k=-271733879,l=-1732584194,m=271733878,n=0;n<h.length;n++)h[n]=16711935&(h[n]<<8|h[n]>>>24)|4278255360&(h[n]<<24|h[n]>>>8);h[i>>>5]|=128<<i%32,h[(i+64>>>9<<4)+14]=i;for(var o=g._ff,p=g._gg,q=g._hh,r=g._ii,n=0;n<h.length;n+=16){var s=j,t=k,u=l,v=m;j=o(j,k,l,m,h[n+0],7,-680876936),m=o(m,j,k,l,h[n+1],12,-389564586),l=o(l,m,j,k,h[n+2],17,606105819),k=o(k,l,m,j,h[n+3],22,-1044525330),j=o(j,k,l,m,h[n+4],7,-176418897),m=o(m,j,k,l,h[n+5],12,1200080426),l=o(l,m,j,k,h[n+6],17,-1473231341),k=o(k,l,m,j,h[n+7],22,-45705983),j=o(j,k,l,m,h[n+8],7,1770035416),m=o(m,j,k,l,h[n+9],12,-1958414417),l=o(l,m,j,k,h[n+10],17,-42063),k=o(k,l,m,j,h[n+11],22,-1990404162),j=o(j,k,l,m,h[n+12],7,1804603682),m=o(m,j,k,l,h[n+13],12,-40341101),l=o(l,m,j,k,h[n+14],17,-1502002290),k=o(k,l,m,j,h[n+15],22,1236535329),j=p(j,k,l,m,h[n+1],5,-165796510),m=p(m,j,k,l,h[n+6],9,-1069501632),l=p(l,m,j,k,h[n+11],14,643717713),k=p(k,l,m,j,h[n+0],20,-373897302),j=p(j,k,l,m,h[n+5],5,-701558691),m=p(m,j,k,l,h[n+10],9,38016083),l=p(l,m,j,k,h[n+15],14,-660478335),k=p(k,l,m,j,h[n+4],20,-405537848),j=p(j,k,l,m,h[n+9],5,568446438),m=p(m,j,k,l,h[n+14],9,-1019803690),l=p(l,m,j,k,h[n+3],14,-187363961),k=p(k,l,m,j,h[n+8],20,1163531501),j=p(j,k,l,m,h[n+13],5,-1444681467),m=p(m,j,k,l,h[n+2],9,-51403784),l=p(l,m,j,k,h[n+7],14,1735328473),k=p(k,l,m,j,h[n+12],20,-1926607734),j=q(j,k,l,m,h[n+5],4,-378558),m=q(m,j,k,l,h[n+8],11,-2022574463),l=q(l,m,j,k,h[n+11],16,1839030562),k=q(k,l,m,j,h[n+14],23,-35309556),j=q(j,k,l,m,h[n+1],4,-1530992060),m=q(m,j,k,l,h[n+4],11,1272893353),l=q(l,m,j,k,h[n+7],16,-155497632),k=q(k,l,m,j,h[n+10],23,-1094730640),j=q(j,k,l,m,h[n+13],4,681279174),m=q(m,j,k,l,h[n+0],11,-358537222),l=q(l,m,j,k,h[n+3],16,-722521979),k=q(k,l,m,j,h[n+6],23,76029189),j=q(j,k,l,m,h[n+9],4,-640364487),m=q(m,j,k,l,h[n+12],11,-421815835),l=q(l,m,j,k,h[n+15],16,530742520),k=q(k,l,m,j,h[n+2],23,-995338651),j=r(j,k,l,m,h[n+0],6,-198630844),m=r(m,j,k,l,h[n+7],10,1126891415),l=r(l,m,j,k,h[n+14],15,-1416354905),k=r(k,l,m,j,h[n+5],21,-57434055),j=r(j,k,l,m,h[n+12],6,1700485571),m=r(m,j,k,l,h[n+3],10,-1894986606),l=r(l,m,j,k,h[n+10],15,-1051523),k=r(k,l,m,j,h[n+1],21,-2054922799),j=r(j,k,l,m,h[n+8],6,1873313359),m=r(m,j,k,l,h[n+15],10,-30611744),l=r(l,m,j,k,h[n+6],15,-1560198380),k=r(k,l,m,j,h[n+13],21,1309151649),j=r(j,k,l,m,h[n+4],6,-145523070),m=r(m,j,k,l,h[n+11],10,-1120210379),l=r(l,m,j,k,h[n+2],15,718787259),k=r(k,l,m,j,h[n+9],21,-343485551),j=j+s>>>0,k=k+t>>>0,l=l+u>>>0,m=m+v>>>0}return d.endian([j,k,l,m])};g._ff=function(a,b,c,d,e,f,g){var h=a+(b&c|~b&d)+(e>>>0)+g;return(h<<f|h>>>32-f)+b},g._gg=function(a,b,c,d,e,f,g){var h=a+(b&d|c&~d)+(e>>>0)+g;return(h<<f|h>>>32-f)+b},g._hh=function(a,b,c,d,e,f,g){var h=a+(b^c^d)+(e>>>0)+g;return(h<<f|h>>>32-f)+b},g._ii=function(a,b,c,d,e,f,g){var h=a+(c^(b|~d))+(e>>>0)+g;return(h<<f|h>>>32-f)+b},g._blocksize=16,g._digestsize=16,b.exports=function(a,b){if("undefined"!=typeof a){var c=d.wordsToBytes(g(a,b));return b&&b.asBytes?c:b&&b.asString?f.bytesToString(c):d.bytesToHex(c)}}}()}).call(this,a("buffer").Buffer)},{buffer:50,charenc:20,crypt:21}],20:[function(a,b){var c={utf8:{stringToBytes:function(a){return c.bin.stringToBytes(unescape(encodeURIComponent(a)))},bytesToString:function(a){return decodeURIComponent(escape(c.bin.bytesToString(a)))}},bin:{stringToBytes:function(a){for(var b=[],c=0;c<a.length;c++)b.push(255&a.charCodeAt(c));return b},bytesToString:function(a){for(var b=[],c=0;c<a.length;c++)b.push(String.fromCharCode(a[c]));return b.join("")
}}};b.exports=c},{}],21:[function(a,b){!function(){var a="ABCDEFGHIJKLMNOPQRSTUVWXYZabcdefghijklmnopqrstuvwxyz0123456789+/",c={rotl:function(a,b){return a<<b|a>>>32-b},rotr:function(a,b){return a<<32-b|a>>>b},endian:function(a){if(a.constructor==Number)return 16711935&c.rotl(a,8)|4278255360&c.rotl(a,24);for(var b=0;b<a.length;b++)a[b]=c.endian(a[b]);return a},randomBytes:function(a){for(var b=[];a>0;a--)b.push(Math.floor(256*Math.random()));return b},bytesToWords:function(a){for(var b=[],c=0,d=0;c<a.length;c++,d+=8)b[d>>>5]|=a[c]<<24-d%32;return b},wordsToBytes:function(a){for(var b=[],c=0;c<32*a.length;c+=8)b.push(a[c>>>5]>>>24-c%32&255);return b},bytesToHex:function(a){for(var b=[],c=0;c<a.length;c++)b.push((a[c]>>>4).toString(16)),b.push((15&a[c]).toString(16));return b.join("")},hexToBytes:function(a){for(var b=[],c=0;c<a.length;c+=2)b.push(parseInt(a.substr(c,2),16));return b},bytesToBase64:function(b){for(var c=[],d=0;d<b.length;d+=3)for(var e=b[d]<<16|b[d+1]<<8|b[d+2],f=0;4>f;f++)c.push(8*d+6*f<=8*b.length?a.charAt(e>>>6*(3-f)&63):"=");return c.join("")},base64ToBytes:function(b){b=b.replace(/[^A-Z0-9+\/]/gi,"");for(var c=[],d=0,e=0;d<b.length;e=++d%4)0!=e&&c.push((a.indexOf(b.charAt(d-1))&Math.pow(2,-2*e+8)-1)<<2*e|a.indexOf(b.charAt(d))>>>6-2*e);return c}};b.exports=c}()},{}],22:[function(a,b){(function(a){function c(a,b){if("function"!=typeof b)throw new Error("Bad callback given: "+b);if(!a)throw new Error("No options given");var g=a.onResponse;if(a="string"==typeof a?{uri:a}:JSON.parse(JSON.stringify(a)),a.onResponse=g,a.verbose&&(c.log=f()),a.url&&(a.uri=a.url,delete a.url),!a.uri&&""!==a.uri)throw new Error("options.uri is a required argument");if("string"!=typeof a.uri)throw new Error("options.uri must be a string");for(var h=["proxy","_redirectsFollowed","maxRedirects","followRedirect"],j=0;j<h.length;j++)if(a[h[j]])throw new Error("options."+h[j]+" is not supported");if(a.callback=b,a.method=a.method||"GET",a.headers=a.headers||{},a.body=a.body||null,a.timeout=a.timeout||c.DEFAULT_TIMEOUT,a.headers.host)throw new Error("Options.headers.host is not supported");a.json&&(a.headers.accept=a.headers.accept||"application/json","GET"!==a.method&&(a.headers["content-type"]="application/json"),"boolean"!=typeof a.json?a.body=JSON.stringify(a.json):"string"!=typeof a.body&&(a.body=JSON.stringify(a.body)));var k=function(a){var b=[];for(var c in a)a.hasOwnProperty(c)&&b.push(encodeURIComponent(c)+"="+encodeURIComponent(a[c]));return b.join("&")};if(a.qs){var l="string"==typeof a.qs?a.qs:k(a.qs);a.uri=-1!==a.uri.indexOf("?")?a.uri+"&"+l:a.uri+"?"+l}var m=function(a){var b={};b.boundry="-------------------------------"+Math.floor(1e9*Math.random());var c=[];for(var d in a)a.hasOwnProperty(d)&&c.push("--"+b.boundry+'\nContent-Disposition: form-data; name="'+d+'"\n\n'+a[d]+"\n");return c.push("--"+b.boundry+"--"),b.body=c.join(""),b.length=b.body.length,b.type="multipart/form-data; boundary="+b.boundry,b};if(a.form){if("string"==typeof a.form)throw"form name unsupported";if("POST"===a.method){var n=(a.encoding||"application/x-www-form-urlencoded").toLowerCase();switch(a.headers["content-type"]=n,n){case"application/x-www-form-urlencoded":a.body=k(a.form).replace(/%20/g,"+");break;case"multipart/form-data":var o=m(a.form);a.body=o.body,a.headers["content-type"]=o.type;break;default:throw new Error("unsupported encoding:"+n)}}}return a.onResponse=a.onResponse||e,a.onResponse===!0&&(a.onResponse=b,a.callback=e),!a.headers.authorization&&a.auth&&(a.headers.authorization="Basic "+i(a.auth.username+":"+a.auth.password)),d(a)}function d(b){function d(){m=!0;var a=new Error("ETIMEDOUT");return a.code="ETIMEDOUT",a.duration=b.timeout,c.log.error("Timeout",{id:k._id,milliseconds:b.timeout}),b.callback(a,k)}function e(){if(m)return c.log.debug("Ignoring timed out state change",{state:k.readyState,id:k.id});if(c.log.debug("State change",{state:k.readyState,id:k.id,timed_out:m}),k.readyState===j.OPENED){c.log.debug("Request started",{id:k.id});for(var a in b.headers)k.setRequestHeader(a,b.headers[a])}else k.readyState===j.HEADERS_RECEIVED?f():k.readyState===j.LOADING?(f(),g()):k.readyState===j.DONE&&(f(),g(),i())}function f(){if(!q.response){if(q.response=!0,c.log.debug("Got response",{id:k.id,status:k.status}),clearTimeout(k.timeoutTimer),k.statusCode=k.status,n&&0==k.statusCode){var a=new Error("CORS request rejected: "+b.uri);return a.cors="rejected",q.loading=!0,q.end=!0,b.callback(a,k)}b.onResponse(null,k)}}function g(){q.loading||(q.loading=!0,c.log.debug("Response body loading",{id:k.id}))}function i(){if(!q.end){if(q.end=!0,c.log.debug("Request done",{id:k.id}),null===b.encoding)k.body=new a(new Uint8Array(k.response));else if(k.body=k.responseText,b.json)try{k.body=JSON.parse(k.responseText)}catch(d){return b.callback(d,k)}b.callback(null,k,k.body)}}var k=new j,m=!1,n=h(b.uri),o="withCredentials"in k;if(l+=1,k.seq_id=l,k.id=l+": "+b.method+" "+b.uri,k._id=k.id,n&&!o){var p=new Error("Browser does not support cross-origin request: "+b.uri);return p.cors="unsupported",b.callback(p,k)}k.timeoutTimer=setTimeout(d,b.timeout);var q={response:!1,loading:!1,end:!1};return k.onreadystatechange=e,k.open(b.method,b.uri,!0),null===b.encoding&&(k.responseType="arraybuffer"),n&&(k.withCredentials=!!b.withCredentials),k.send(b.body),k}function e(){}function f(){var a,b,c={},d=["trace","debug","info","warn","error"];for(b=0;b<d.length;b++)a=d[b],c[a]=e,"undefined"!=typeof console&&console&&console[a]&&(c[a]=g(console,a));return c}function g(a,b){function c(c,d){return"object"==typeof d&&(c+=" "+JSON.stringify(d)),a[b].call(a,c)}return c}function h(a){var b,c=/^([\w\+\.\-]+:)(?:\/\/([^\/?#:]*)(?::(\d+))?)?/;try{b=location.href}catch(d){b=document.createElement("a"),b.href="",b=b.href}var e=c.exec(b.toLowerCase())||[],f=c.exec(a.toLowerCase()),g=!(!f||f[1]==e[1]&&f[2]==e[2]&&(f[3]||("http:"===f[1]?80:443))==(e[3]||("http:"===e[1]?80:443)));return g}function i(a){var b,c,d,e,f,g,h,i,j="ABCDEFGHIJKLMNOPQRSTUVWXYZabcdefghijklmnopqrstuvwxyz0123456789+/=",k=0,l=0,m="",n=[];if(!a)return a;do b=a.charCodeAt(k++),c=a.charCodeAt(k++),d=a.charCodeAt(k++),i=b<<16|c<<8|d,e=i>>18&63,f=i>>12&63,g=i>>6&63,h=63&i,n[l++]=j.charAt(e)+j.charAt(f)+j.charAt(g)+j.charAt(h);while(k<a.length);switch(m=n.join(""),a.length%3){case 1:m=m.slice(0,-2)+"==";break;case 2:m=m.slice(0,-1)+"="}return m}var j=XMLHttpRequest;if(!j)throw new Error("missing XMLHttpRequest");c.log={trace:e,debug:e,info:e,warn:e,error:e};var k=18e4,l=0;c.withCredentials=!1,c.DEFAULT_TIMEOUT=k,c.defaults=function(a){var b=function(b){var c=function(c,d){c="string"==typeof c?{uri:c}:JSON.parse(JSON.stringify(c));for(var e in a)void 0===c[e]&&(c[e]=a[e]);return b(c,d)};return c},d=b(c);return d.get=b(c.get),d.post=b(c.post),d.put=b(c.put),d.head=b(c.head),d};var m=["get","put","post","head"];m.forEach(function(a){var b=a.toUpperCase(),d=a.toLowerCase();c[d]=function(a){"string"==typeof a?a={method:b,uri:a}:(a=JSON.parse(JSON.stringify(a)),a.method=b);var d=[a].concat(Array.prototype.slice.apply(arguments,[1]));return c.apply(this,d)}}),c.couch=function(a,b){function d(a,c,d){if(a)return b(a,c,d);if((c.statusCode<200||c.statusCode>299)&&d.error){a=new Error("CouchDB error: "+(d.error.reason||d.error.error));for(var e in d)a[e]=d[e];return b(a,c,d)}return b(a,c,d)}"string"==typeof a&&(a={uri:a}),a.json=!0,a.body&&(a.json=a.body),delete a.body,b=b||e;var f=c(a,d);return f},b.exports=c}).call(this,a("buffer").Buffer)},{buffer:50}],23:[function(a,b){function c(){this._events=this._events||{},this._maxListeners=this._maxListeners||void 0}function d(a){return"function"==typeof a}function e(a){return"number"==typeof a}function f(a){return"object"==typeof a&&null!==a}function g(a){return void 0===a}b.exports=c,c.EventEmitter=c,c.prototype._events=void 0,c.prototype._maxListeners=void 0,c.defaultMaxListeners=10,c.prototype.setMaxListeners=function(a){if(!e(a)||0>a||isNaN(a))throw TypeError("n must be a positive number");return this._maxListeners=a,this},c.prototype.emit=function(a){var b,c,e,h,i,j;if(this._events||(this._events={}),"error"===a&&(!this._events.error||f(this._events.error)&&!this._events.error.length)){if(b=arguments[1],b instanceof Error)throw b;throw TypeError('Uncaught, unspecified "error" event.')}if(c=this._events[a],g(c))return!1;if(d(c))switch(arguments.length){case 1:c.call(this);break;case 2:c.call(this,arguments[1]);break;case 3:c.call(this,arguments[1],arguments[2]);break;default:for(e=arguments.length,h=new Array(e-1),i=1;e>i;i++)h[i-1]=arguments[i];c.apply(this,h)}else if(f(c)){for(e=arguments.length,h=new Array(e-1),i=1;e>i;i++)h[i-1]=arguments[i];for(j=c.slice(),e=j.length,i=0;e>i;i++)j[i].apply(this,h)}return!0},c.prototype.addListener=function(a,b){var e;if(!d(b))throw TypeError("listener must be a function");if(this._events||(this._events={}),this._events.newListener&&this.emit("newListener",a,d(b.listener)?b.listener:b),this._events[a]?f(this._events[a])?this._events[a].push(b):this._events[a]=[this._events[a],b]:this._events[a]=b,f(this._events[a])&&!this._events[a].warned){var e;e=g(this._maxListeners)?c.defaultMaxListeners:this._maxListeners,e&&e>0&&this._events[a].length>e&&(this._events[a].warned=!0,console.error("(node) warning: possible EventEmitter memory leak detected. %d listeners added. Use emitter.setMaxListeners() to increase limit.",this._events[a].length),"function"==typeof console.trace&&console.trace())}return this},c.prototype.on=c.prototype.addListener,c.prototype.once=function(a,b){function c(){this.removeListener(a,c),e||(e=!0,b.apply(this,arguments))}if(!d(b))throw TypeError("listener must be a function");var e=!1;return c.listener=b,this.on(a,c),this},c.prototype.removeListener=function(a,b){var c,e,g,h;if(!d(b))throw TypeError("listener must be a function");if(!this._events||!this._events[a])return this;if(c=this._events[a],g=c.length,e=-1,c===b||d(c.listener)&&c.listener===b)delete this._events[a],this._events.removeListener&&this.emit("removeListener",a,b);else if(f(c)){for(h=g;h-->0;)if(c[h]===b||c[h].listener&&c[h].listener===b){e=h;break}if(0>e)return this;1===c.length?(c.length=0,delete this._events[a]):c.splice(e,1),this._events.removeListener&&this.emit("removeListener",a,b)}return this},c.prototype.removeAllListeners=function(a){var b,c;if(!this._events)return this;if(!this._events.removeListener)return 0===arguments.length?this._events={}:this._events[a]&&delete this._events[a],this;if(0===arguments.length){for(b in this._events)"removeListener"!==b&&this.removeAllListeners(b);return this.removeAllListeners("removeListener"),this._events={},this}if(c=this._events[a],d(c))this.removeListener(a,c);else for(;c.length;)this.removeListener(a,c[c.length-1]);return delete this._events[a],this},c.prototype.listeners=function(a){var b;return b=this._events&&this._events[a]?d(this._events[a])?[this._events[a]]:this._events[a].slice():[]},c.listenerCount=function(a,b){var c;return c=a._events&&a._events[b]?d(a._events[b])?1:a._events[b].length:0}},{}],24:[function(b,c){(function(b){!function(){var d={};"undefined"!=typeof b&&b.nextTick?(d.nextTick=b.nextTick,d.setImmediate="undefined"!=typeof setImmediate?function(a){setImmediate(a)}:d.nextTick):"function"==typeof setImmediate?(d.nextTick=function(a){setImmediate(a)},d.setImmediate=d.nextTick):(d.nextTick=function(a){setTimeout(a,0)},d.setImmediate=d.nextTick),d.eachSeries=function(a,b,c){if(c=c||function(){},!a.length)return c();var d=0,e=function(){b(a[d],function(b){b?(c(b),c=function(){}):(d+=1,d>=a.length?c():e())})};e()},d.forEachSeries=d.eachSeries,"undefined"!=typeof a&&a.amd?a([],function(){return d}):"undefined"!=typeof c&&c.exports?c.exports=d:root.async=d}()}).call(this,b("_process"))},{_process:53}],25:[function(a,b){function c(a,b){for(var c=b.length-1;c>=0;c--)b[c]===a&&b.splice(c,1);return b}var d=function(){};d.createInterface=function(a){var b={};return b.on=function(b,c){"undefined"==typeof this[a]&&(this[a]={}),this[a].hasOwnProperty(b)||(this[a][b]=[]),this[a][b].push(c)},b.off=function(b,d){"undefined"!=typeof this[a]&&this[a].hasOwnProperty(b)&&c(d,this[a][b])},b.trigger=function(b){if("undefined"!=typeof this[a]&&this[a].hasOwnProperty(b))for(var c=Array.prototype.slice.call(arguments,1),d=0;d<this[a][b].length;d++)this[a][b][d].apply(this[a][b][d],c)},b.removeAllListeners=function(b){if("undefined"!=typeof this[a]){var c=this;c[a][b].forEach(function(a){c.off(b,a)})}},b};var e=d.createInterface("_handlers");d.prototype._on=e.on,d.prototype._off=e.off,d.prototype._trigger=e.trigger;var f=d.createInterface("handlers");d.prototype.on=function(){f.on.apply(this,arguments),Array.prototype.unshift.call(arguments,"on"),this._trigger.apply(this,arguments)},d.prototype.off=f.off,d.prototype.trigger=f.trigger,d.prototype.removeAllListeners=f.removeAllListeners,b.exports=d},{}],26:[function(a,b){(function(c){function d(a,b){var c=0;return function(){var d=Date.now();d-c>a&&(c=d,b.apply(this,arguments))}}function e(a,b){if("undefined"!=typeof a&&a||(a={}),"object"==typeof b)for(var c in b)b.hasOwnProperty(c)&&(a[c]=b[c]);return a}function f(){var a=this,b=Date.now();this.origin=h(),this.lastMessage=b,this.receivedIDs={},this.previousValues={};var d=function(){a._onStorageEvent.apply(a,arguments)};"undefined"!=typeof document&&(document.attachEvent?document.attachEvent("onstorage",d):c.addEventListener("storage",d,!1))}var g=a("./eventemitter.js"),h=a("../src/shared.js").guid,i=function(a){return"undefined"==typeof a||"undefined"==typeof a.localStorage?{getItem:function(){},setItem:function(){},removeItem:function(){}}:a.localStorage}(c);f.prototype._transaction=function(a){function b(){if(!g){var k=Date.now(),m=0|i.getItem(l);if(m&&d>k-m)return h||(f._on("storage",b),h=!0),void(j=setTimeout(b,e));g=!0,i.setItem(l,k),a(),c()}}function c(){h&&f._off("storage",b),j&&clearTimeout(j),i.removeItem(l)}var d=1e3,e=20,f=this,g=!1,h=!1,j=null;b()},f.prototype._cleanup_emit=d(100,function(){var a=this;a._transaction(function(){var a,b=Date.now(),c=b-m,d=0;try{a=JSON.parse(i.getItem(j)||"[]")}catch(e){a=[]}for(var f=a.length-1;f>=0;f--)a[f].timestamp<c&&(a.splice(f,1),d++);d>0&&i.setItem(j,JSON.stringify(a))})}),f.prototype._cleanup_once=d(100,function(){var a=this;a._transaction(function(){var b,c,d=(Date.now(),0);try{c=JSON.parse(i.getItem(k)||"{}")}catch(e){c={}}for(b in c)a._once_expired(b,c)&&(delete c[b],d++);d>0&&i.setItem(k,JSON.stringify(c))})}),f.prototype._once_expired=function(a,b){if(!b)return!0;if(!b.hasOwnProperty(a))return!0;if("object"!=typeof b[a])return!0;var c=b[a].ttl||n,d=Date.now(),e=b[a].timestamp;return d-c>e},f.prototype._localStorageChanged=function(a,b){if(a&&a.key)return a.key===b;var c=i.getItem(b);return c===this.previousValues[b]?!1:(this.previousValues[b]=c,!0)},f.prototype._onStorageEvent=function(a){a=a||c.event;var b=this;this._localStorageChanged(a,j)&&this._transaction(function(){var a,c=Date.now(),d=i.getItem(j);try{a=JSON.parse(d||"[]")}catch(e){a=[]}for(var f=0;f<a.length;f++)if(a[f].origin!==b.origin&&!(a[f].timestamp<b.lastMessage)){if(a[f].id){if(b.receivedIDs.hasOwnProperty(a[f].id))continue;b.receivedIDs[a[f].id]=!0}b.trigger(a[f].name,a[f].payload)}b.lastMessage=c}),this._trigger("storage",a)},f.prototype._emit=function(a,b,c){if(c="string"==typeof c||"number"==typeof c?String(c):null,c&&c.length){if(this.receivedIDs.hasOwnProperty(c))return;this.receivedIDs[c]=!0}var d={id:c,name:a,origin:this.origin,timestamp:Date.now(),payload:b},e=this;this._transaction(function(){var c=i.getItem(j)||"[]",f="[]"===c?"":",";c=[c.substring(0,c.length-1),f,JSON.stringify(d),"]"].join(""),i.setItem(j,c),e.trigger(a,b),setTimeout(function(){e._cleanup_emit()},50)})},f.prototype.emit=function(a,b){this._emit.apply(this,arguments),this._trigger("emit",a,b)},f.prototype.once=function(a,b,c){if(f.supported){var d=this;this._transaction(function(){var e;try{e=JSON.parse(i.getItem(k)||"{}")}catch(f){e={}}d._once_expired(a,e)&&(e[a]={},e[a].timestamp=Date.now(),"number"==typeof c&&(e[a].ttl=1e3*c),i.setItem(k,JSON.stringify(e)),b(),setTimeout(function(){d._cleanup_once()},50))})}},e(f.prototype,g.prototype),f.supported="undefined"!=typeof i;var j="intercom",k="intercom_once",l="intercom_lock",m=5e4,n=36e5;f.destroy=function(){i.removeItem(l),i.removeItem(j),i.removeItem(k)},f.getInstance=function(){var a;return function(){return a||(a=new f),a}}(),b.exports=f}).call(this,"undefined"!=typeof global?global:"undefined"!=typeof self?self:"undefined"!=typeof window?window:{})},{"../src/shared.js":45,"./eventemitter.js":25}],27:[function(a,b){function c(a,b){return p.call(a,b)}function d(a){return null==a?0:a.length===+a.length?a.length:s(a).length}function e(a){return a}function f(a,b,c){var d,e;if(null!=a)if(l&&a.forEach===l)a.forEach(b,c);else if(a.length===+a.length){for(d=0,e=a.length;e>d;d++)if(b.call(c,a[d],d,a)===r)return}else{var f=f(a);for(d=0,e=f.length;e>d;d++)if(b.call(c,a[f[d]],f[d],a)===r)return}}function g(a,b,c){b||(b=e);var d=!1;return null==a?d:n&&a.some===n?a.some(b,c):(f(a,function(a,e,f){return d||(d=b.call(c,a,e,f))?r:void 0}),!!d)}function h(a,b){return null==a?!1:m&&a.indexOf===m?-1!=a.indexOf(b):g(a,function(a){return a===b})}function i(a){this.value=a}function j(a){return a&&"object"==typeof a&&!Array.isArray(a)&&p.call(a,"__wrapped__")?a:new i(a)}var k=Array.prototype,l=k.forEach,m=k.indexOf,n=k.some,o=Object.prototype,p=o.hasOwnProperty,q=Object.keys,r={},s=q||function(a){if(a!==Object(a))throw new TypeError("Invalid object");var b=[];for(var d in a)c(a,d)&&b.push(d);return b};i.prototype.has=function(a){return c(this.value,a)},i.prototype.contains=function(a){return h(this.value,a)},i.prototype.size=function(){return d(this.value)},b.exports=j},{}],28:[function(a,b,c){!function(a){"use strict";c.encode=function(b){var c,d=new Uint8Array(b),e=d.length,f="";for(c=0;e>c;c+=3)f+=a[d[c]>>2],f+=a[(3&d[c])<<4|d[c+1]>>4],f+=a[(15&d[c+1])<<2|d[c+2]>>6],f+=a[63&d[c+2]];return e%3===2?f=f.substring(0,f.length-1)+"=":e%3===1&&(f=f.substring(0,f.length-2)+"=="),f},c.decode=function(b){var c,d,e,f,g,h=.75*b.length,i=b.length,j=0;"="===b[b.length-1]&&(h--,"="===b[b.length-2]&&h--);var k=new ArrayBuffer(h),l=new Uint8Array(k);for(c=0;i>c;c+=4)d=a.indexOf(b[c]),e=a.indexOf(b[c+1]),f=a.indexOf(b[c+2]),g=a.indexOf(b[c+3]),l[j++]=d<<2|e>>4,l[j++]=(15&e)<<4|f>>2,l[j++]=(3&f)<<6|63&g;return k}}("ABCDEFGHIJKLMNOPQRSTUVWXYZabcdefghijklmnopqrstuvwxyz0123456789+/")},{}],29:[function(a,b){(function(a){function c(b,c,d){return b instanceof ArrayBuffer&&(b=new Uint8Array(b)),new a(b,c,d)}c.prototype=Object.create(a.prototype),c.prototype.constructor=c,Object.keys(a).forEach(function(b){a.hasOwnProperty(b)&&(c[b]=a[b])}),b.exports=c}).call(this,a("buffer").Buffer)},{buffer:50}],30:[function(a,b){var c="READ",d="WRITE",e="CREATE",f="EXCLUSIVE",g="TRUNCATE",h="APPEND",i="CREATE",j="REPLACE";b.exports={FILE_SYSTEM_NAME:"local",FILE_STORE_NAME:"files",IDB_RO:"readonly",IDB_RW:"readwrite",WSQL_VERSION:"1",WSQL_SIZE:5242880,WSQL_DESC:"FileSystem Storage",MODE_FILE:"FILE",MODE_DIRECTORY:"DIRECTORY",MODE_SYMBOLIC_LINK:"SYMLINK",MODE_META:"META",SYMLOOP_MAX:10,BINARY_MIME_TYPE:"application/octet-stream",JSON_MIME_TYPE:"application/json",ROOT_DIRECTORY_NAME:"/",FS_FORMAT:"FORMAT",FS_NOCTIME:"NOCTIME",FS_NOMTIME:"NOMTIME",FS_NODUPEIDCHECK:"FS_NODUPEIDCHECK",O_READ:c,O_WRITE:d,O_CREATE:e,O_EXCLUSIVE:f,O_TRUNCATE:g,O_APPEND:h,O_FLAGS:{r:[c],"r+":[c,d],w:[d,e,g],"w+":[d,c,e,g],wx:[d,e,f,g],"wx+":[d,c,e,f,g],a:[d,e,h],"a+":[d,c,e,h],ax:[d,e,f,h],"ax+":[d,c,e,f,h]},XATTR_CREATE:i,XATTR_REPLACE:j,FS_READY:"READY",FS_PENDING:"PENDING",FS_ERROR:"ERROR",SUPER_NODE_ID:"00000000-0000-0000-0000-000000000000",STDIN:0,STDOUT:1,STDERR:2,FIRST_DESCRIPTOR:3,ENVIRONMENT:{TMP:"/tmp",PATH:""}}},{}],31:[function(a,b){var c=a("./constants.js").MODE_FILE;b.exports=function(a,b){this.id=a,this.type=b||c}},{"./constants.js":30}],32:[function(a,b){(function(a){function c(a){return a.toString("utf8")}function d(b){return new a(b,"utf8")}b.exports={encode:d,decode:c}}).call(this,a("buffer").Buffer)},{buffer:50}],33:[function(a,b){var c={};["9:EBADF:bad file descriptor","10:EBUSY:resource busy or locked","18:EINVAL:invalid argument","27:ENOTDIR:not a directory","28:EISDIR:illegal operation on a directory","34:ENOENT:no such file or directory","47:EEXIST:file already exists","51:ELOOP:too many symbolic links encountered","53:ENOTEMPTY:directory not empty","55:EIO:i/o error","1000:ENOTMOUNTED:not mounted","1001:EFILESYSTEMERROR:missing super node, use 'FORMAT' flag to format filesystem.","1002:ENOATTR:attribute does not exist"].forEach(function(a){function b(a,b){Error.call(this),this.name=e,this.code=e,this.errno=d,this.message=a||f,b&&(this.path=b),this.stack=new Error(this.message).stack}a=a.split(":");var d=+a[0],e=a[1],f=a[2];b.prototype=Object.create(Error.prototype),b.prototype.constructor=b,b.prototype.toString=function(){var a=this.path?", '"+this.path+"'":"";return this.name+": "+this.message+a},c[e]=c[d]=b}),b.exports=c},{}],34:[function(a,b){function c(a){return function(b,c){b?a(b):a(null,c)}}function d(a,b,c,d,e){function f(c){a.changes.push({event:"change",path:b}),e(c)}var g=a.flags;mb(g).contains(Kb)&&delete d.ctime,mb(g).contains(Jb)&&delete d.mtime;var h=!1;d.ctime&&(c.ctime=d.ctime,c.atime=d.ctime,h=!0),d.atime&&(c.atime=d.atime,h=!0),d.mtime&&(c.mtime=d.mtime,h=!0),h?a.putObject(c.id,c,f):f()}function e(a,b,c,e){function g(c,d){c?e(c):d.mode!==vb?e(new Mb.ENOTDIR("a component of the path prefix is not a directory",b)):(l=d,f(a,b,h))}function h(c,d){!c&&d?e(new Mb.EEXIST("path name already exists",b)):!c||c instanceof Mb.ENOENT?a.getObject(l.data,i):e(c)}function i(b,d){b?e(b):(m=d,Qb.create({guid:a.guid,mode:c},function(b,c){return b?void e(b):(n=c,n.nlinks+=1,void a.putObject(n.id,n,k))}))}function j(b){if(b)e(b);else{var c=Date.now();d(a,p,n,{mtime:c,ctime:c},e)}}function k(b){b?e(b):(m[o]=new Nb(n.id,c),a.putObject(l.data,m,j))}if(c!==vb&&c!==ub)return e(new Mb.EINVAL("mode must be a directory or file",b));b=ob(b);var l,m,n,o=qb(b),p=pb(b);f(a,p,g)}function f(a,b,c){function d(b,d){b?c(b):d&&d.mode===xb&&d.rnode?a.getObject(d.rnode,e):c(new Mb.EFILESYSTEMERROR)}function e(a,b){a?c(a):b?c(null,b):c(new Mb.ENOENT)}function g(d,e){d?c(d):e.mode===vb&&e.data?a.getObject(e.data,h):c(new Mb.ENOTDIR("a component of the path prefix is not a directory",b))}function h(d,e){if(d)c(d);else if(mb(e).has(k)){var f=e[k].id;a.getObject(f,i)}else c(new Mb.ENOENT(null,b))}function i(a,d){a?c(a):d.mode==wb?(m++,m>Ab?c(new Mb.ELOOP(null,b)):j(d.data)):c(null,d)}function j(b){b=ob(b),l=pb(b),k=qb(b),yb==k?a.getObject(zb,d):f(a,l,g)}if(b=ob(b),!b)return c(new Mb.ENOENT("path is an empty string"));var k=qb(b),l=pb(b),m=0;yb==k?a.getObject(zb,d):f(a,l,g)}function g(a,b,c,e,g,h){function i(f,i){function k(b){b?h(b):d(a,j,i,{ctime:Date.now()},h)}i?i.xattrs[c]:null;f?h(f):g===Hb&&i.xattrs.hasOwnProperty(c)?h(new Mb.EEXIST("attribute already exists",b)):g!==Ib||i.xattrs.hasOwnProperty(c)?(i.xattrs[c]=e,a.putObject(i.id,i,k)):h(new Mb.ENOATTR(null,b))}var j;"string"==typeof b?(j=b,f(a,b,i)):"object"==typeof b&&"string"==typeof b.id?(j=b.path,a.getObject(b.id,i)):h(new Mb.EINVAL("path or file descriptor of wrong type",b))}function h(a,b){function c(c,e){!c&&e?b():!c||c instanceof Mb.ENOENT?Pb.create({guid:a.guid},function(c,e){return c?void b(c):(f=e,void a.putObject(f.id,f,d))}):b(c)}function d(c){c?b(c):Qb.create({guid:a.guid,id:f.rnode,mode:vb},function(c,d){return c?void b(c):(g=d,g.nlinks+=1,void a.putObject(g.id,g,e))})}function e(c){c?b(c):(h={},a.putObject(g.data,h,b))}var f,g,h;a.getObject(zb,c)}function i(a,b,c){function e(d,e){!d&&e?c(new Mb.EEXIST(null,b)):!d||d instanceof Mb.ENOENT?f(a,q,g):c(d)}function g(b,d){b?c(b):(n=d,a.getObject(n.data,h))}function h(b,d){b?c(b):(o=d,Qb.create({guid:a.guid,mode:vb},function(b,d){return b?void c(b):(l=d,l.nlinks+=1,void a.putObject(l.id,l,i))}))}function i(b){b?c(b):(m={},a.putObject(l.data,m,k))}function j(b){if(b)c(b);else{var e=Date.now();d(a,q,n,{mtime:e,ctime:e},c)}}function k(b){b?c(b):(o[p]=new Nb(l.id,vb),a.putObject(n.data,o,j))}b=ob(b);var l,m,n,o,p=qb(b),q=pb(b);f(a,b,e)}function j(a,b,c){function e(b,d){b?c(b):(p=d,a.getObject(p.data,g))}function g(d,e){d?c(d):yb==r?c(new Mb.EBUSY(null,b)):mb(e).has(r)?(q=e,n=q[r].id,a.getObject(n,h)):c(new Mb.ENOENT(null,b))}function h(d,e){d?c(d):e.mode!=vb?c(new Mb.ENOTDIR(null,b)):(n=e,a.getObject(n.data,i))}function i(a,d){a?c(a):(o=d,mb(o).size()>0?c(new Mb.ENOTEMPTY(null,b)):k())}function j(b){if(b)c(b);else{var e=Date.now();d(a,s,p,{mtime:e,ctime:e},l)}}function k(){delete q[r],a.putObject(p.data,q,j)}function l(b){b?c(b):a.delete(n.id,m)}function m(b){b?c(b):a.delete(n.data,c)}b=ob(b);var n,o,p,q,r=qb(b),s=pb(b);f(a,s,e)}function k(a,b,c,e){function g(c,d){c?e(c):d.mode!==vb?e(new Mb.ENOENT(null,b)):(q=d,a.getObject(q.data,h))}function h(d,f){d?e(d):(r=f,mb(r).has(v)?mb(c).contains(Eb)?e(new Mb.ENOENT("O_CREATE and O_EXCLUSIVE are set, and the named file exists",b)):(s=r[v],s.type==vb&&mb(c).contains(Cb)?e(new Mb.EISDIR("the named file is a directory and O_WRITE is set",b)):a.getObject(s.id,i)):mb(c).contains(Db)?l():e(new Mb.ENOENT("O_CREATE is not set and the named file does not exist",b)))}function i(a,c){if(a)e(a);else{var d=c;d.mode==wb?(x++,x>Ab?e(new Mb.ELOOP(null,b)):j(d.data)):k(void 0,d)}}function j(d){d=ob(d),w=pb(d),v=qb(d),yb==v&&(mb(c).contains(Cb)?e(new Mb.EISDIR("the named file is a directory and O_WRITE is set",b)):f(a,b,k)),f(a,w,g)}function k(a,b){a?e(a):(t=b,e(null,t))}function l(){Qb.create({guid:a.guid,mode:ub},function(b,c){return b?void e(b):(t=c,t.nlinks+=1,void a.putObject(t.id,t,m))})}function m(b){b?e(b):(u=new Sb(0),u.fill(0),a.putBuffer(t.data,u,o))}function n(b){if(b)e(b);else{var c=Date.now();d(a,w,q,{mtime:c,ctime:c},p)}}function o(b){b?e(b):(r[v]=new Nb(t.id,ub),a.putObject(q.data,r,n))}function p(a){a?e(a):e(null,t)}b=ob(b);var q,r,s,t,u,v=qb(b),w=pb(b),x=0;yb==v?mb(c).contains(Cb)?e(new Mb.EISDIR("the named file is a directory and O_WRITE is set",b)):f(a,b,k):f(a,w,g)}function l(a,b,c,e,f,g){function h(a){a?g(a):g(null,f)}function i(c){if(c)g(c);else{var e=Date.now();d(a,b.path,l,{mtime:e,ctime:e},h)}}function j(b){b?g(b):a.putObject(l.id,l,i)}function k(d,h){if(d)g(d);else{l=h;var i=new Sb(f);i.fill(0),c.copy(i,0,e,e+f),b.position=f,l.size=f,l.version+=1,a.putBuffer(l.data,i,j)}}var l;a.getObject(b.id,k)}function m(a,b,c,e,f,g,h){function i(a){a?h(a):h(null,f)}function j(c){if(c)h(c);else{var e=Date.now();d(a,b.path,n,{mtime:e,ctime:e},i)}}function k(b){b?h(b):a.putObject(n.id,n,j)}function l(d,i){if(d)h(d);else{if(o=i,!o)return h(new Mb.EIO("Expected Buffer"));var j=void 0!==g&&null!==g?g:b.position,l=Math.max(o.length,j+f),m=new Sb(l);m.fill(0),o&&o.copy(m),c.copy(m,j,e,e+f),void 0===g&&(b.position+=f),n.size=l,n.version+=1,a.putBuffer(n.data,m,k)}}function m(b,c){b?h(b):(n=c,a.getBuffer(n.data,l))}var n,o;a.getObject(b.id,m)}function n(a,b,c,d,e,f,g){function h(a,h){if(a)g(a);else{if(k=h,!k)return g(new Mb.EIO("Expected Buffer"));var i=void 0!==f&&null!==f?f:b.position;e=i+e>c.length?e-i:e,k.copy(c,d,i,i+e),void 0===f&&(b.position+=e),g(null,e)}}function i(b,c){b?g(b):(j=c,a.getBuffer(j.data,h))}var j,k;a.getObject(b.id,i)}function o(a,b,d){b=ob(b);qb(b);f(a,b,c(d))}function p(a,b,d){a.getObject(b.id,c(d))}function q(a,b,d){function e(b,c){b?d(b):(h=c,a.getObject(h.data,g))}function g(e,f){e?d(e):(i=f,mb(i).has(j)?a.getObject(i[j].id,c(d)):d(new Mb.ENOENT("a component of the path does not name an existing file",b)))}b=ob(b);var h,i,j=qb(b),k=pb(b);yb==j?f(a,b,c(d)):f(a,k,e)}function r(a,b,c,e){function g(b){b?e(b):d(a,c,t,{ctime:Date.now()},e)}function h(b,c){b?e(b):(t=c,t.nlinks+=1,a.putObject(t.id,t,g))}function i(b){b?e(b):a.getObject(s[u].id,h)}function j(b,c){b?e(b):(s=c,mb(s).has(u)?e(new Mb.EEXIST("newpath resolves to an existing file",u)):(s[u]=q[n],a.putObject(r.data,s,i)))}function k(b,c){b?e(b):(r=c,a.getObject(r.data,j))}function l(b,c){b?e(b):(q=c,mb(q).has(n)?f(a,v,k):e(new Mb.ENOENT("a component of either path prefix does not exist",n)))}function m(b,c){b?e(b):(p=c,a.getObject(p.data,l))}b=ob(b);var n=qb(b),o=pb(b);c=ob(c);var p,q,r,s,t,u=qb(c),v=pb(c);f(a,o,m)}function s(a,b,c){function e(b){b?c(b):(delete l[n],a.putObject(k.data,l,function(){var b=Date.now();d(a,o,k,{mtime:b,ctime:b},c)}))}function g(b){b?c(b):a.delete(m.data,e)}function h(f,h){f?c(f):(m=h,m.nlinks-=1,m.nlinks<1?a.delete(m.id,g):a.putObject(m.id,m,function(){d(a,b,m,{ctime:Date.now()},e)}))}function i(b,d){b?c(b):(l=d,mb(l).has(n)?a.getObject(l[n].id,h):c(new Mb.ENOENT("a component of the path does not name an existing file",n)))}function j(b,d){b?c(b):(k=d,a.getObject(k.data,i))}b=ob(b);var k,l,m,n=qb(b),o=pb(b);f(a,o,j)}function t(a,b,c){function d(a,b){if(a)c(a);else{h=b;var d=Object.keys(h);c(null,d)}}function e(e,f){e?c(e):f.mode!==vb?c(new Mb.ENOTDIR(null,b)):(g=f,a.getObject(g.data,d))}b=ob(b);{var g,h;qb(b)}f(a,b,e)}function u(a,b,c,e){function g(b,c){b?e(b):(l=c,a.getObject(l.data,h))}function h(a,b){a?e(a):(m=b,mb(m).has(o)?e(new Mb.EEXIST(null,o)):i())}function i(){Qb.create({guid:a.guid,mode:wb},function(c,d){return c?void e(c):(n=d,n.nlinks+=1,n.size=b.length,n.data=b,void a.putObject(n.id,n,k))})}function j(b){if(b)e(b);else{var c=Date.now();d(a,p,l,{mtime:c,ctime:c},e)}}function k(b){b?e(b):(m[o]=new Nb(n.id,wb),a.putObject(l.data,m,j))}c=ob(c);var l,m,n,o=qb(c),p=pb(c);yb==o?e(new Mb.EEXIST(null,o)):f(a,p,g)}function v(a,b,c){function d(b,d){b?c(b):(h=d,a.getObject(h.data,e))}function e(b,d){b?c(b):(i=d,mb(i).has(j)?a.getObject(i[j].id,g):c(new Mb.ENOENT("a component of the path does not name an existing file",j)))}function g(a,d){a?c(a):d.mode!=wb?c(new Mb.EINVAL("path not a symbolic link",b)):c(null,d.data)}b=ob(b);var h,i,j=qb(b),k=pb(b);f(a,k,d)}function w(a,b,c,e){function g(c,d){c?e(c):d.mode==vb?e(new Mb.EISDIR(null,b)):(k=d,a.getBuffer(k.data,h))}function h(b,d){if(b)e(b);else{if(!d)return e(new Mb.EIO("Expected Buffer"));var f=new Sb(c);f.fill(0),d&&d.copy(f),a.putBuffer(k.data,f,j)}}function i(c){if(c)e(c);else{var f=Date.now();d(a,b,k,{mtime:f,ctime:f},e)}}function j(b){b?e(b):(k.size=c,k.version+=1,a.putObject(k.id,k,i))}b=ob(b);var k;0>c?e(new Mb.EINVAL("length cannot be negative")):f(a,b,g)}function x(a,b,c,e){function f(b,c){b?e(b):c.mode==vb?e(new Mb.EISDIR):(j=c,a.getBuffer(j.data,g))}function g(b,d){if(b)e(b);else{var f;if(!d)return e(new Mb.EIO("Expected Buffer"));d?f=d.slice(0,c):(f=new Sb(c),f.fill(0)),a.putBuffer(j.data,f,i)}}function h(c){if(c)e(c);else{var f=Date.now();d(a,b.path,j,{mtime:f,ctime:f},e)}}function i(b){b?e(b):(j.size=c,j.version+=1,a.putObject(j.id,j,h))}var j;0>c?e(new Mb.EINVAL("length cannot be negative")):a.getObject(b.id,f)}function y(a,b,c,e,g){function h(f,h){f?g(f):d(a,b,h,{atime:c,ctime:e,mtime:e},g)}b=ob(b),"number"!=typeof c||"number"!=typeof e?g(new Mb.EINVAL("atime and mtime must be number",b)):0>c||0>e?g(new Mb.EINVAL("atime and mtime must be positive integers",b)):f(a,b,h)}function z(a,b,c,e,f){function g(g,h){g?f(g):d(a,b.path,h,{atime:c,ctime:e,mtime:e},f)}"number"!=typeof c||"number"!=typeof e?f(new Mb.EINVAL("atime and mtime must be a number")):0>c||0>e?f(new Mb.EINVAL("atime and mtime must be positive integers")):a.getObject(b.id,g)}function A(a,b,c,d,e,f){b=ob(b),"string"!=typeof c?f(new Mb.EINVAL("attribute name must be a string",b)):c?null!==e&&e!==Hb&&e!==Ib?f(new Mb.EINVAL("invalid flag, must be null, XATTR_CREATE or XATTR_REPLACE",b)):g(a,b,c,d,e,f):f(new Mb.EINVAL("attribute name cannot be an empty string",b))}function B(a,b,c,d,e,f){"string"!=typeof c?f(new Mb.EINVAL("attribute name must be a string")):c?null!==e&&e!==Hb&&e!==Ib?f(new Mb.EINVAL("invalid flag, must be null, XATTR_CREATE or XATTR_REPLACE")):g(a,b,c,d,e,f):f(new Mb.EINVAL("attribute name cannot be an empty string"))}function C(a,b,c,d){function e(a,e){e?e.xattrs[c]:null;a?d(a):e.xattrs.hasOwnProperty(c)?d(null,e.xattrs[c]):d(new Mb.ENOATTR(null,b))
}b=ob(b),"string"!=typeof c?d(new Mb.EINVAL("attribute name must be a string",b)):c?f(a,b,e):d(new Mb.EINVAL("attribute name cannot be an empty string",b))}function D(a,b,c,d){function e(a,b){b?b.xattrs[c]:null;a?d(a):b.xattrs.hasOwnProperty(c)?d(null,b.xattrs[c]):d(new Mb.ENOATTR)}"string"!=typeof c?d(new Mb.EINVAL):c?a.getObject(b.id,e):d(new Mb.EINVAL("attribute name cannot be an empty string"))}function E(a,b,c,e){function g(f,g){function h(c){c?e(c):d(a,b,g,{ctime:Date.now()},e)}var i=g?g.xattrs:null;f?e(f):i.hasOwnProperty(c)?(delete g.xattrs[c],a.putObject(g.id,g,h)):e(new Mb.ENOATTR(null,b))}b=ob(b),"string"!=typeof c?e(new Mb.EINVAL("attribute name must be a string",b)):c?f(a,b,g):e(new Mb.EINVAL("attribute name cannot be an empty string",b))}function F(a,b,c,e){function f(f,g){function h(c){c?e(c):d(a,b.path,g,{ctime:Date.now()},e)}f?e(f):g.xattrs.hasOwnProperty(c)?(delete g.xattrs[c],a.putObject(g.id,g,h)):e(new Mb.ENOATTR)}"string"!=typeof c?e(new Mb.EINVAL("attribute name must be a string")):c?a.getObject(b.id,f):e(new Mb.EINVAL("attribute name cannot be an empty string"))}function G(a){return mb(Gb).has(a)?Gb[a]:null}function H(a,b,c){return a?"function"==typeof a?a={encoding:b,flag:c}:"string"==typeof a&&(a={encoding:a,flag:c}):a={encoding:b,flag:c},a}function I(a,b){var c;return a?sb(a)?c=new Mb.EINVAL("Path must be a string without null bytes.",a):rb(a)||(c=new Mb.EINVAL("Path must be absolute.",a)):c=new Mb.EINVAL("Path must be a string",a),c?(b(c),!1):!0}function J(a,b,c,d,e,f){function g(b,e){if(b)f(b);else{var g;g=mb(d).contains(Fb)?e.size:0;var h=new Ob(c,e.id,d,g),i=a.allocDescriptor(h);f(null,i)}}f=arguments[arguments.length-1],I(c,f)&&(d=G(d),d||f(new Mb.EINVAL("flags is not valid"),c),k(b,c,d,g))}function K(a,b,c,d){mb(a.openFiles).has(c)?(a.releaseDescriptor(c),d(null)):d(new Mb.EBADF)}function L(a,b,c,d,f){I(c,f)&&e(b,c,d,f)}function M(a,b,d,e,f){f=arguments[arguments.length-1],I(d,f)&&i(b,d,c(f))}function N(a,b,d,e){I(d,e)&&j(b,d,c(e))}function O(a,b,c,d){function e(b,c){if(b)d(b);else{var e=new Rb(c,a.name);d(null,e)}}I(c,d)&&o(b,c,e)}function P(a,b,c,d){function e(b,c){if(b)d(b);else{var e=new Rb(c,a.name);d(null,e)}}var f=a.openFiles[c];f?p(b,f,e):d(new Mb.EBADF)}function Q(a,b,d,e,f){I(d,f)&&I(e,f)&&r(b,d,e,c(f))}function R(a,b,d,e){I(d,e)&&s(b,d,c(e))}function S(a,b,d,e,f,g,h,i){function j(a,b){i(a,b||0,e)}f=void 0===f?0:f,g=void 0===g?e.length-f:g,i=arguments[arguments.length-1];var k=a.openFiles[d];k?mb(k.flags).contains(Bb)?n(b,k,e,f,g,h,c(j)):i(new Mb.EBADF("descriptor does not permit reading")):i(new Mb.EBADF)}function T(a,b,c,d,e){if(e=arguments[arguments.length-1],d=H(d,null,"r"),I(c,e)){var f=G(d.flag||"r");return f?void k(b,c,f,function(g,h){function i(){a.releaseDescriptor(k)}if(g)return e(g);var j=new Ob(c,h.id,f,0),k=a.allocDescriptor(j);p(b,j,function(f,g){if(f)return i(),e(f);var h=new Rb(g,a.name);if(h.isDirectory())return i(),e(new Mb.EISDIR("illegal operation on directory",c));var k=h.size,l=new Sb(k);l.fill(0),n(b,j,l,0,k,0,function(a){if(i(),a)return e(a);var b;b="utf8"===d.encoding?Lb.decode(l):l,e(null,b)})})}):e(new Mb.EINVAL("flags is not valid",c))}}function U(a,b,d,e,f,g,h,i){i=arguments[arguments.length-1],f=void 0===f?0:f,g=void 0===g?e.length-f:g;var j=a.openFiles[d];j?mb(j.flags).contains(Cb)?e.length-f<g?i(new Mb.EIO("intput buffer is too small")):m(b,j,e,f,g,h,c(i)):i(new Mb.EBADF("descriptor does not permit writing")):i(new Mb.EBADF)}function V(a,b,c,d,e,f){if(f=arguments[arguments.length-1],e=H(e,"utf8","w"),I(c,f)){var g=G(e.flag||"w");if(!g)return f(new Mb.EINVAL("flags is not valid",c));d=d||"","number"==typeof d&&(d=""+d),"string"==typeof d&&"utf8"===e.encoding&&(d=Lb.encode(d)),k(b,c,g,function(e,h){if(e)return f(e);var i=new Ob(c,h.id,g,0),j=a.allocDescriptor(i);l(b,i,d,0,d.length,function(b){return a.releaseDescriptor(j),b?f(b):void f(null)})})}}function W(a,b,c,d,e,f){if(f=arguments[arguments.length-1],e=H(e,"utf8","a"),I(c,f)){var g=G(e.flag||"a");if(!g)return f(new Mb.EINVAL("flags is not valid",c));d=d||"","number"==typeof d&&(d=""+d),"string"==typeof d&&"utf8"===e.encoding&&(d=Lb.encode(d)),k(b,c,g,function(e,h){if(e)return f(e);var i=new Ob(c,h.id,g,h.size),j=a.allocDescriptor(i);m(b,i,d,0,d.length,i.position,function(b){return a.releaseDescriptor(j),b?f(b):void f(null)})})}}function X(a,b,c,d){function e(a){d(a?!1:!0)}O(a,b,c,e)}function Y(a,b,d,e,f){I(d,f)&&C(b,d,e,c(f))}function Z(a,b,d,e,f){var g=a.openFiles[d];g?D(b,g,e,c(f)):f(new Mb.EBADF)}function $(a,b,d,e,f,g,h){"function"==typeof g&&(h=g,g=null),I(d,h)&&A(b,d,e,f,g,c(h))}function _(a,b,d,e,f,g,h){"function"==typeof g&&(h=g,g=null);var i=a.openFiles[d];i?mb(i.flags).contains(Cb)?B(b,i,e,f,g,c(h)):h(new Mb.EBADF("descriptor does not permit writing")):h(new Mb.EBADF)}function ab(a,b,d,e,f){I(d,f)&&E(b,d,e,c(f))}function bb(a,b,d,e,f){var g=a.openFiles[d];g?mb(g.flags).contains(Cb)?F(b,g,e,c(f)):f(new Mb.EBADF("descriptor does not permit writing")):f(new Mb.EBADF)}function cb(a,b,c,d,e,f){function g(a,b){a?f(a):b.size+d<0?f(new Mb.EINVAL("resulting file offset would be negative")):(h.position=b.size+d,f(null,h.position))}var h=a.openFiles[c];h||f(new Mb.EBADF),"SET"===e?0>d?f(new Mb.EINVAL("resulting file offset would be negative")):(h.position=d,f(null,h.position)):"CUR"===e?h.position+d<0?f(new Mb.EINVAL("resulting file offset would be negative")):(h.position+=d,f(null,h.position)):"END"===e?p(b,h,g):f(new Mb.EINVAL("whence argument is not a proper value"))}function db(a,b,d,e){I(d,e)&&t(b,d,c(e))}function eb(a,b,d,e,f,g){if(I(d,g)){var h=Date.now();e=e?e:h,f=f?f:h,y(b,d,e,f,c(g))}}function fb(a,b,d,e,f,g){var h=Date.now();e=e?e:h,f=f?f:h;var i=a.openFiles[d];i?mb(i.flags).contains(Cb)?z(b,i,e,f,c(g)):g(new Mb.EBADF("descriptor does not permit writing")):g(new Mb.EBADF)}function gb(a,b,d,e,f){function g(a){a?f(a):s(b,d,c(f))}I(d,f)&&I(e,f)&&r(b,d,e,g)}function hb(a,b,d,e,f,g){g=arguments[arguments.length-1],I(d,g)&&I(e,g)&&u(b,d,e,c(g))}function ib(a,b,d,e){I(d,e)&&v(b,d,c(e))}function jb(a,b,c,d){function e(b,c){if(b)d(b);else{var e=new Rb(c,a.name);d(null,e)}}I(c,d)&&q(b,c,e)}function kb(a,b,d,e,f){f=arguments[arguments.length-1],e=e||0,I(d,f)&&w(b,d,e,c(f))}function lb(a,b,d,e,f){f=arguments[arguments.length-1],e=e||0;var g=a.openFiles[d];g?mb(g.flags).contains(Cb)?x(b,g,e,c(f)):f(new Mb.EBADF("descriptor does not permit writing")):f(new Mb.EBADF)}var mb=a("../../lib/nodash.js"),nb=a("../path.js"),ob=nb.normalize,pb=nb.dirname,qb=nb.basename,rb=nb.isAbsolute,sb=nb.isNull,tb=a("../constants.js"),ub=tb.MODE_FILE,vb=tb.MODE_DIRECTORY,wb=tb.MODE_SYMBOLIC_LINK,xb=tb.MODE_META,yb=tb.ROOT_DIRECTORY_NAME,zb=tb.SUPER_NODE_ID,Ab=tb.SYMLOOP_MAX,Bb=tb.O_READ,Cb=tb.O_WRITE,Db=tb.O_CREATE,Eb=tb.O_EXCLUSIVE,Fb=(tb.O_TRUNCATE,tb.O_APPEND),Gb=tb.O_FLAGS,Hb=tb.XATTR_CREATE,Ib=tb.XATTR_REPLACE,Jb=tb.FS_NOMTIME,Kb=tb.FS_NOCTIME,Lb=a("../encoding.js"),Mb=a("../errors.js"),Nb=a("../directory-entry.js"),Ob=a("../open-file-description.js"),Pb=a("../super-node.js"),Qb=a("../node.js"),Rb=a("../stats.js"),Sb=a("../buffer.js");b.exports={ensureRootDirectory:h,open:J,close:K,mknod:L,mkdir:M,rmdir:N,unlink:R,stat:O,fstat:P,link:Q,read:S,readFile:T,write:U,writeFile:V,appendFile:W,exists:X,getxattr:Y,fgetxattr:Z,setxattr:$,fsetxattr:_,removexattr:ab,fremovexattr:bb,lseek:cb,readdir:db,utimes:eb,futimes:fb,rename:gb,symlink:hb,readlink:ib,lstat:jb,truncate:kb,ftruncate:lb}},{"../../lib/nodash.js":27,"../buffer.js":29,"../constants.js":30,"../directory-entry.js":31,"../encoding.js":32,"../errors.js":33,"../node.js":38,"../open-file-description.js":39,"../path.js":40,"../stats.js":48,"../super-node.js":49}],35:[function(a,b){function c(a){return"function"==typeof a?a:function(a){if(a)throw a}}function d(a,b){function c(){G.forEach(function(a){a.call(this)}.bind(D)),G=null}function d(a){return function(b){function c(b){var d=z();a.getObject(d,function(a,e){return a?void b(a):void(e?c(b):b(null,d))})}return e(p).contains(n)?void b(null,z()):void c(b)}}function h(a){if(a.length){var b=q.getInstance();a.forEach(function(a){b.emit(a.event,a.path)})}}a=a||{},b=b||g;var p=a.flags,z=a.guid?a.guid:t,A=a.provider||new o.Default(a.name||i),B=a.name||A.name,C=e(p).contains(j),D=this;D.readyState=l,D.name=B,D.error=null,D.stdin=u,D.stdout=v,D.stderr=w;var E={},F=x;Object.defineProperty(this,"openFiles",{get:function(){return E}}),this.allocDescriptor=function(a){var b=F++;return E[b]=a,b},this.releaseDescriptor=function(a){delete E[a]};var G=[];this.queueOrRun=function(a){var b;return k==D.readyState?a.call(D):m==D.readyState?b=new s.EFILESYSTEMERROR("unknown error"):G.push(a),b},this.watch=function(a,b,c){if(f(a))throw new Error("Path must be a string without null bytes.");"function"==typeof b&&(c=b,b={}),b=b||{},c=c||g;var d=new r;return d.start(a,!1,b.recursive),d.on("change",c),d},A.open(function(a){function e(a){function e(a){var b=A[a]();return b.flags=p,b.changes=[],b.guid=d(b),b.close=function(){var a=b.changes;h(a),a.length=0},b}D.provider={openReadWriteContext:function(){return e("getReadWriteContext")},openReadOnlyContext:function(){return e("getReadOnlyContext")}},D.readyState=a?m:k,c(),b(a,D)}if(a)return e(a);var f=A.getReadWriteContext();f.guid=d(f),C?f.clear(function(a){return a?e(a):void y.ensureRootDirectory(f,e)}):y.ensureRootDirectory(f,e)})}var e=a("../../lib/nodash.js"),f=a("../path.js").isNull,g=a("../shared.js").nop,h=a("../constants.js"),i=h.FILE_SYSTEM_NAME,j=h.FS_FORMAT,k=h.FS_READY,l=h.FS_PENDING,m=h.FS_ERROR,n=h.FS_NODUPEIDCHECK,o=a("../providers/index.js"),p=a("../shell/shell.js"),q=a("../../lib/intercom.js"),r=a("../fs-watcher.js"),s=a("../errors.js"),t=a("../shared.js").guid,u=h.STDIN,v=h.STDOUT,w=h.STDERR,x=h.FIRST_DESCRIPTOR,y=a("./implementation.js");d.providers=o,["open","close","mknod","mkdir","rmdir","stat","fstat","link","unlink","read","readFile","write","writeFile","appendFile","exists","lseek","readdir","rename","readlink","symlink","lstat","truncate","ftruncate","utimes","futimes","setxattr","getxattr","fsetxattr","fgetxattr","removexattr","fremovexattr"].forEach(function(a){d.prototype[a]=function(){var b=this,d=Array.prototype.slice.call(arguments,0),e=d.length-1,f="function"!=typeof d[e],g=c(d[e]),h=b.queueOrRun(function(){function c(){h.close(),g.apply(b,arguments)}var h=b.provider.openReadWriteContext();if(m===b.readyState){var i=new s.EFILESYSTEMERROR("filesystem unavailable, operation canceled");return g.call(b,i)}f?d.push(c):d[e]=c;var j=[b,h].concat(d);y[a].apply(null,j)});h&&g(h)}}),d.prototype.Shell=function(a){return new p(this,a)},b.exports=d},{"../../lib/intercom.js":26,"../../lib/nodash.js":27,"../constants.js":30,"../errors.js":33,"../fs-watcher.js":36,"../path.js":40,"../providers/index.js":41,"../shared.js":45,"../shell/shell.js":47,"./implementation.js":34}],36:[function(a,b){function c(){function a(a){(c===a||h&&0===a.indexOf(b))&&g.trigger("change","change",a)}d.call(this);var b,c,g=this,h=!1;g.start=function(d,g,i){if(!c){if(e.isNull(d))throw new Error("Path must be a string without null bytes.");c=e.normalize(d),h=i===!0,h&&(b="/"===c?"/":c+"/");var j=f.getInstance();j.on("change",a)}},g.close=function(){var b=f.getInstance();b.off("change",a),g.removeAllListeners("change")}}var d=a("../lib/eventemitter.js"),e=a("./path.js"),f=a("../lib/intercom.js");c.prototype=new d,c.prototype.constructor=c,b.exports=c},{"../lib/eventemitter.js":25,"../lib/intercom.js":26,"./path.js":40}],37:[function(a,b){b.exports={FileSystem:a("./filesystem/interface.js"),Buffer:a("./buffer.js"),Path:a("./path.js"),Errors:a("./errors.js")}},{"./buffer.js":29,"./errors.js":33,"./filesystem/interface.js":35,"./path.js":40}],38:[function(a,b){function c(a){var b=Date.now();this.id=a.id,this.mode=a.mode||e,this.size=a.size||0,this.atime=a.atime||b,this.ctime=a.ctime||b,this.mtime=a.mtime||b,this.flags=a.flags||[],this.xattrs=a.xattrs||{},this.nlinks=a.nlinks||0,this.version=a.version||0,this.blksize=void 0,this.nblocks=1,this.data=a.data}function d(a,b,c){a[b]?c(null):a.guid(function(d,e){a[b]=e,c(d)})}var e=a("./constants.js").MODE_FILE;c.create=function(a,b){d(a,"id",function(e){return e?void b(e):void d(a,"data",function(d){return d?void b(d):void b(null,new c(a))})})},b.exports=c},{"./constants.js":30}],39:[function(a,b){b.exports=function(a,b,c,d){this.path=a,this.id=b,this.flags=c,this.position=d}},{}],40:[function(a,b,c){function d(a,b){for(var c=0,d=a.length-1;d>=0;d--){var e=a[d];"."===e?a.splice(d,1):".."===e?(a.splice(d,1),c++):c&&(a.splice(d,1),c--)}if(b)for(;c--;c)a.unshift("..");return a}function e(){for(var a="",b=!1,c=arguments.length-1;c>=-1&&!b;c--){var e=c>=0?arguments[c]:"/";"string"==typeof e&&e&&(a=e+"/"+a,b="/"===e.charAt(0))}return a=d(a.split("/").filter(function(a){return!!a}),!b).join("/"),(b?"/":"")+a||"."}function f(a){{var b="/"===a.charAt(0);"/"===a.substr(-1)}return a=d(a.split("/").filter(function(a){return!!a}),!b).join("/"),a||b||(a="."),(b?"/":"")+a}function g(){var a=Array.prototype.slice.call(arguments,0);return f(a.filter(function(a){return a&&"string"==typeof a}).join("/"))}function h(a,b){function d(a){for(var b=0;b<a.length&&""===a[b];b++);for(var c=a.length-1;c>=0&&""===a[c];c--);return b>c?[]:a.slice(b,c-b+1)}a=c.resolve(a).substr(1),b=c.resolve(b).substr(1);for(var e=d(a.split("/")),f=d(b.split("/")),g=Math.min(e.length,f.length),h=g,i=0;g>i;i++)if(e[i]!==f[i]){h=i;break}for(var j=[],i=h;i<e.length;i++)j.push("..");return j=j.concat(f.slice(h)),j.join("/")}function i(a){var b=o(a),c=b[0],d=b[1];return c||d?(d&&(d=d.substr(0,d.length-1)),c+d):"."}function j(a,b){var c=o(a)[2];return b&&c.substr(-1*b.length)===b&&(c=c.substr(0,c.length-b.length)),""===c?"/":c}function k(a){return o(a)[3]}function l(a){return"/"===a.charAt(0)?!0:!1}function m(a){return-1!==(""+a).indexOf("\x00")?!0:!1}var n=/^(\/?)([\s\S]+\/(?!$)|\/)?((?:\.{1,2}$|[\s\S]+?)?(\.[^.\/]*)?)$/,o=function(a){var b=n.exec(a);return[b[1]||"",b[2]||"",b[3]||"",b[4]||""]};b.exports={normalize:f,resolve:e,join:g,relative:h,sep:"/",delimiter:":",dirname:i,basename:j,extname:k,isAbsolute:l,isNull:m}},{}],41:[function(a,b){var c=a("./indexeddb.js"),d=a("./websql.js"),e=a("./memory.js");b.exports={IndexedDB:c,WebSQL:d,Memory:e,Default:c,Fallback:function(){function a(){throw"[Filer Error] Your browser doesn't support IndexedDB or WebSQL."}return c.isSupported()?c:d.isSupported()?d:(a.isSupported=function(){return!1},a)}()}},{"./indexeddb.js":42,"./memory.js":43,"./websql.js":44}],42:[function(a,b){(function(c){function d(a,b){var c=a.transaction(i,b);this.objectStore=c.objectStore(i)}function e(a,b,c){try{var d=a.get(b);d.onsuccess=function(a){var b=a.target.result;c(null,b)},d.onerror=function(a){c(a)}}catch(e){c(e)}}function f(a,b,c,d){try{var e=a.put(c,b);e.onsuccess=function(a){var b=a.target.result;d(null,b)},e.onerror=function(a){d(a)}}catch(f){d(f)}}function g(a){this.name=a||h,this.db=null}var h=a("../constants.js").FILE_SYSTEM_NAME,i=a("../constants.js").FILE_STORE_NAME,j=a("../constants.js").IDB_RW,k=(a("../constants.js").IDB_RO,a("../errors.js")),l=a("../buffer.js"),m=c.indexedDB||c.mozIndexedDB||c.webkitIndexedDB||c.msIndexedDB;d.prototype.clear=function(a){try{var b=this.objectStore.clear();b.onsuccess=function(){a()},b.onerror=function(b){a(b)}}catch(c){a(c)}},d.prototype.getObject=function(a,b){e(this.objectStore,a,b)},d.prototype.getBuffer=function(a,b){e(this.objectStore,a,function(a,c){return a?b(a):void b(null,new l(c))})},d.prototype.putObject=function(a,b,c){f(this.objectStore,a,b,c)},d.prototype.putBuffer=function(a,b,c){f(this.objectStore,a,b.buffer,c)},d.prototype.delete=function(a,b){try{var c=this.objectStore.delete(a);c.onsuccess=function(a){var c=a.target.result;b(null,c)},c.onerror=function(a){b(a)}}catch(d){b(d)}},g.isSupported=function(){return!!m},g.prototype.open=function(a){var b=this;if(b.db)return a();var c=m.open(b.name);c.onupgradeneeded=function(a){var b=a.target.result;b.objectStoreNames.contains(i)&&b.deleteObjectStore(i),b.createObjectStore(i)},c.onsuccess=function(c){b.db=c.target.result,a()},c.onerror=function(){a(new k.EINVAL("IndexedDB cannot be accessed. If private browsing is enabled, disable it."))}},g.prototype.getReadOnlyContext=function(){return new d(this.db,j)},g.prototype.getReadWriteContext=function(){return new d(this.db,j)},b.exports=g}).call(this,"undefined"!=typeof global?global:"undefined"!=typeof self?self:"undefined"!=typeof window?window:{})},{"../buffer.js":29,"../constants.js":30,"../errors.js":33}],43:[function(a,b){function c(a,b){this.readOnly=b,this.objectStore=a}function d(a){this.name=a||e}var e=a("../constants.js").FILE_SYSTEM_NAME,f=a("../../lib/async.js").setImmediate,g=function(){var a={};return function(b){return a.hasOwnProperty(b)||(a[b]={}),a[b]}}();c.prototype.clear=function(a){if(this.readOnly)return void f(function(){a("[MemoryContext] Error: write operation on read only context")});var b=this.objectStore;Object.keys(b).forEach(function(a){delete b[a]}),f(a)},c.prototype.getObject=c.prototype.getBuffer=function(a,b){var c=this;f(function(){b(null,c.objectStore[a])})},c.prototype.putObject=c.prototype.putBuffer=function(a,b,c){return this.readOnly?void f(function(){c("[MemoryContext] Error: write operation on read only context")}):(this.objectStore[a]=b,void f(c))},c.prototype.delete=function(a,b){return this.readOnly?void f(function(){b("[MemoryContext] Error: write operation on read only context")}):(delete this.objectStore[a],void f(b))},d.isSupported=function(){return!0},d.prototype.open=function(a){this.db=g(this.name),f(a)},d.prototype.getReadOnlyContext=function(){return new c(this.db,!0)},d.prototype.getReadWriteContext=function(){return new c(this.db,!1)},b.exports=d},{"../../lib/async.js":24,"../constants.js":30}],44:[function(a,b){(function(c){function d(a,b){var c=this;this.getTransaction=function(d){return c.transaction?void d(c.transaction):void a[b?"readTransaction":"transaction"](function(a){c.transaction=a,d(a)})}}function e(a,b,c){function d(a,b){var d=0===b.rows.length?null:b.rows.item(0).data;c(null,d)}function e(a,b){c(b)}a(function(a){a.executeSql("SELECT data FROM "+i+" WHERE id = ? LIMIT 1;",[b],d,e)})}function f(a,b,c,d){function e(){d(null)}function f(a,b){d(b)}a(function(a){a.executeSql("INSERT OR REPLACE INTO "+i+" (id, data) VALUES (?, ?);",[b,c],e,f)})}function g(a){this.name=a||h,this.db=null}var h=a("../constants.js").FILE_SYSTEM_NAME,i=a("../constants.js").FILE_STORE_NAME,j=a("../constants.js").WSQL_VERSION,k=a("../constants.js").WSQL_SIZE,l=a("../constants.js").WSQL_DESC,m=a("../errors.js"),n=a("../buffer.js"),o=a("base64-arraybuffer");d.prototype.clear=function(a){function b(b,c){a(c)}function c(){a(null)}this.getTransaction(function(a){a.executeSql("DELETE FROM "+i+";",[],c,b)})},d.prototype.getObject=function(a,b){e(this.getTransaction,a,function(a,c){if(a)return b(a);try{c&&(c=JSON.parse(c))}catch(d){return b(d)}b(null,c)})},d.prototype.getBuffer=function(a,b){e(this.getTransaction,a,function(a,c){if(a)return b(a);if(c||""===c){var d=o.decode(c);c=new n(d)}b(null,c)})},d.prototype.putObject=function(a,b,c){var d=JSON.stringify(b);f(this.getTransaction,a,d,c)},d.prototype.putBuffer=function(a,b,c){var d=o.encode(b.buffer);f(this.getTransaction,a,d,c)},d.prototype.delete=function(a,b){function c(){b(null)}function d(a,c){b(c)}this.getTransaction(function(b){b.executeSql("DELETE FROM "+i+" WHERE id = ?;",[a],c,d)})},g.isSupported=function(){return!!c.openDatabase},g.prototype.open=function(a){function b(b,c){5===c.code&&a(new m.EINVAL("WebSQL cannot be accessed. If private browsing is enabled, disable it.")),a(c)}function d(){e.db=f,a()}var e=this;if(e.db)return a();var f=c.openDatabase(e.name,j,l,k);return f?void f.transaction(function(a){function c(a){a.executeSql("CREATE INDEX IF NOT EXISTS idx_"+i+"_id on "+i+" (id);",[],d,b)}a.executeSql("CREATE TABLE IF NOT EXISTS "+i+" (id unique, data TEXT);",[],c,b)}):void a("[WebSQL] Unable to open database.")},g.prototype.getReadOnlyContext=function(){return new d(this.db,!0)},g.prototype.getReadWriteContext=function(){return new d(this.db,!1)},b.exports=g}).call(this,"undefined"!=typeof global?global:"undefined"!=typeof self?self:"undefined"!=typeof window?window:{})},{"../buffer.js":29,"../constants.js":30,"../errors.js":33,"base64-arraybuffer":28}],45:[function(a,b){function c(){return"xxxxxxxx-xxxx-4xxx-yxxx-xxxxxxxxxxxx".replace(/[xy]/g,function(a){var b=16*Math.random()|0,c="x"==a?b:3&b|8;return c.toString(16)}).toUpperCase()}function d(){}function e(a){for(var b=[],c=a.length,d=0;c>d;d++)b[d]=a[d];return b}b.exports={guid:c,u8toArray:e,nop:d}},{}],46:[function(a,b){var c=a("../constants.js").ENVIRONMENT;b.exports=function(a){a=a||{},a.TMP=a.TMP||c.TMP,a.PATH=a.PATH||c.PATH,this.get=function(b){return a[b]},this.set=function(b,c){a[b]=c}}},{"../constants.js":30}],47:[function(a,b){function c(a,b){b=b||{};var c=new f(b.env),g="/";Object.defineProperty(this,"fs",{get:function(){return a},enumerable:!0}),Object.defineProperty(this,"env",{get:function(){return c},enumerable:!0}),this.cd=function(b,c){b=d.resolve(g,b),a.stat(b,function(a,d){return a?void c(new e.ENOTDIR(null,b)):void("DIRECTORY"===d.type?(g=b,c()):c(new e.ENOTDIR(null,b)))})},this.pwd=function(){return g}}{var d=a("../path.js"),e=a("../errors.js"),f=a("./environment.js"),g=a("../../lib/async.js");a("../encoding.js")}c.prototype.exec=function(a,b,c){var e=this,f=e.fs;"function"==typeof b&&(c=b,b=[]),b=b||[],c=c||function(){},a=d.resolve(e.pwd(),a),f.readFile(a,"utf8",function(a,d){if(a)return void c(a);try{var e=new Function("fs","args","callback",d);e(f,b,c)}catch(g){c(g)}})},c.prototype.touch=function(a,b,c){function e(a){h.writeFile(a,"",c)}function f(a){var d=Date.now(),e=b.date||d,f=b.date||d;h.utimes(a,e,f,c)}var g=this,h=g.fs;"function"==typeof b&&(c=b,b={}),b=b||{},c=c||function(){},a=d.resolve(g.pwd(),a),h.stat(a,function(d){d?b.updateOnly===!0?c():e(a):f(a)})},c.prototype.cat=function(a,b){function c(a,b){var c=d.resolve(f.pwd(),a);h.readFile(c,"utf8",function(a,c){return a?void b(a):(i+=c+"\n",void b())})}var f=this,h=f.fs,i="";return b=b||function(){},a?(a="string"==typeof a?[a]:a,void g.eachSeries(a,c,function(a){a?b(a):b(null,i.replace(/\n$/,""))})):void b(new e.EINVAL("Missing files argument"))},c.prototype.ls=function(a,b,c){function f(a,c){var e=d.resolve(h.pwd(),a),j=[];i.readdir(e,function(a,h){function k(a,c){a=d.join(e,a),i.stat(a,function(g,h){if(g)return void c(g);var i={path:d.basename(a),links:h.nlinks,size:h.size,modified:h.mtime,type:h.type};b.recursive&&"DIRECTORY"===h.type?f(d.join(e,i.path),function(a,b){return a?void c(a):(i.contents=b,j.push(i),void c())}):(j.push(i),c())})}return a?void c(a):void g.eachSeries(h,k,function(a){c(a,j)})})}var h=this,i=h.fs;return"function"==typeof b&&(c=b,b={}),b=b||{},c=c||function(){},a?void f(a,c):void c(new e.EINVAL("Missing dir argument"))},c.prototype.rm=function(a,b,c){function f(a,c){a=d.resolve(h.pwd(),a),i.stat(a,function(h,j){return h?void c(h):"FILE"===j.type?void i.unlink(a,c):void i.readdir(a,function(h,j){return h?void c(h):0===j.length?void i.rmdir(a,c):b.recursive?(j=j.map(function(b){return d.join(a,b)}),void g.eachSeries(j,f,function(b){return b?void c(b):void i.rmdir(a,c)})):void c(new e.ENOTEMPTY(null,a))})})}var h=this,i=h.fs;return"function"==typeof b&&(c=b,b={}),b=b||{},c=c||function(){},a?void f(a,c):void c(new e.EINVAL("Missing path argument"))},c.prototype.tempDir=function(a){var b=this,c=b.fs,d=b.env.get("TMP");a=a||function(){},c.mkdir(d,function(){a(null,d)})},c.prototype.mkdirp=function(a,b){function c(a,b){g.stat(a,function(f,h){if(h){if(h.isDirectory())return void b();if(h.isFile())return void b(new e.ENOTDIR(null,a))}else{if(f&&"ENOENT"!==f.code)return void b(f);var i=d.dirname(a);"/"===i?g.mkdir(a,function(a){return a&&"EEXIST"!=a.code?void b(a):void b()}):c(i,function(c){return c?b(c):void g.mkdir(a,function(a){return a&&"EEXIST"!=a.code?void b(a):void b()})})}})}var f=this,g=f.fs;return b=b||function(){},a?"/"===a?void b():void c(a,b):void b(new e.EINVAL("Missing path argument"))},b.exports=c},{"../../lib/async.js":24,"../encoding.js":32,"../errors.js":33,"../path.js":40,"./environment.js":46}],48:[function(a,b){function c(a,b){this.node=a.id,this.dev=b,this.size=a.size,this.nlinks=a.nlinks,this.atime=a.atime,this.mtime=a.mtime,this.ctime=a.ctime,this.type=a.mode}var d=a("./constants.js");c.prototype.isFile=function(){return this.type===d.MODE_FILE},c.prototype.isDirectory=function(){return this.type===d.MODE_DIRECTORY},c.prototype.isSymbolicLink=function(){return this.type===d.MODE_SYMBOLIC_LINK},c.prototype.isSocket=c.prototype.isFIFO=c.prototype.isCharacterDevice=c.prototype.isBlockDevice=function(){return!1},b.exports=c},{"./constants.js":30}],49:[function(a,b){function c(a){var b=Date.now();this.id=d.SUPER_NODE_ID,this.mode=d.MODE_META,this.atime=a.atime||b,this.ctime=a.ctime||b,this.mtime=a.mtime||b,this.rnode=a.rnode}var d=a("./constants.js");c.create=function(a,b){a.guid(function(d,e){return d?void b(d):(a.rnode=a.rnode||e,void b(null,new c(a)))})},b.exports=c},{"./constants.js":30}],50:[function(a,b,c){function d(a,b,c){if(!(this instanceof d))return new d(a,b,c);var e,f=typeof a;if("number"===f)e=a>0?a>>>0:0;else if("string"===f)"base64"===b&&(a=C(a)),e=d.byteLength(a,b);else{if("object"!==f||null===a)throw new Error("First argument needs to be a number, array or string.");"Buffer"===a.type&&E(a.data)&&(a=a.data),e=+a.length>0?Math.floor(+a.length):0}var g;T?g=d._augment(new Uint8Array(e)):(g=this,g.length=e,g._isBuffer=!0);var h;if(T&&"number"==typeof a.byteLength)g._set(a);else if(F(a))if(d.isBuffer(a))for(h=0;e>h;h++)g[h]=a.readUInt8(h);else for(h=0;e>h;h++)g[h]=(a[h]%256+256)%256;else if("string"===f)g.write(a,0,b);else if("number"===f&&!T&&!c)for(h=0;e>h;h++)g[h]=0;return g}function e(a,b,c,d){c=Number(c)||0;var e=a.length-c;d?(d=Number(d),d>e&&(d=e)):d=e;var f=b.length;Q(f%2===0,"Invalid hex string"),d>f/2&&(d=f/2);for(var g=0;d>g;g++){var h=parseInt(b.substr(2*g,2),16);Q(!isNaN(h),"Invalid hex string"),a[c+g]=h}return g}function f(a,b,c,d){var e=L(H(b),a,c,d);return e}function g(a,b,c,d){var e=L(I(b),a,c,d);return e}function h(a,b,c,d){return g(a,b,c,d)}function i(a,b,c,d){var e=L(K(b),a,c,d);return e}function j(a,b,c,d){var e=L(J(b),a,c,d);return e}function k(a,b,c){return R.fromByteArray(0===b&&c===a.length?a:a.slice(b,c))}function l(a,b,c){var d="",e="";c=Math.min(a.length,c);for(var f=b;c>f;f++)a[f]<=127?(d+=M(e)+String.fromCharCode(a[f]),e=""):e+="%"+a[f].toString(16);return d+M(e)}function m(a,b,c){var d="";c=Math.min(a.length,c);for(var e=b;c>e;e++)d+=String.fromCharCode(a[e]);return d}function n(a,b,c){return m(a,b,c)}function o(a,b,c){var d=a.length;(!b||0>b)&&(b=0),(!c||0>c||c>d)&&(c=d);for(var e="",f=b;c>f;f++)e+=G(a[f]);return e}function p(a,b,c){for(var d=a.slice(b,c),e="",f=0;f<d.length;f+=2)e+=String.fromCharCode(d[f]+256*d[f+1]);return e}function q(a,b,c,d){d||(Q("boolean"==typeof c,"missing or invalid endian"),Q(void 0!==b&&null!==b,"missing offset"),Q(b+1<a.length,"Trying to read beyond buffer length"));var e=a.length;if(!(b>=e)){var f;return c?(f=a[b],e>b+1&&(f|=a[b+1]<<8)):(f=a[b]<<8,e>b+1&&(f|=a[b+1])),f}}function r(a,b,c,d){d||(Q("boolean"==typeof c,"missing or invalid endian"),Q(void 0!==b&&null!==b,"missing offset"),Q(b+3<a.length,"Trying to read beyond buffer length"));var e=a.length;if(!(b>=e)){var f;return c?(e>b+2&&(f=a[b+2]<<16),e>b+1&&(f|=a[b+1]<<8),f|=a[b],e>b+3&&(f+=a[b+3]<<24>>>0)):(e>b+1&&(f=a[b+1]<<16),e>b+2&&(f|=a[b+2]<<8),e>b+3&&(f|=a[b+3]),f+=a[b]<<24>>>0),f}}function s(a,b,c,d){d||(Q("boolean"==typeof c,"missing or invalid endian"),Q(void 0!==b&&null!==b,"missing offset"),Q(b+1<a.length,"Trying to read beyond buffer length"));var e=a.length;if(!(b>=e)){var f=q(a,b,c,!0),g=32768&f;return g?-1*(65535-f+1):f}}function t(a,b,c,d){d||(Q("boolean"==typeof c,"missing or invalid endian"),Q(void 0!==b&&null!==b,"missing offset"),Q(b+3<a.length,"Trying to read beyond buffer length"));var e=a.length;if(!(b>=e)){var f=r(a,b,c,!0),g=2147483648&f;return g?-1*(4294967295-f+1):f}}function u(a,b,c,d){return d||(Q("boolean"==typeof c,"missing or invalid endian"),Q(b+3<a.length,"Trying to read beyond buffer length")),S.read(a,b,c,23,4)}function v(a,b,c,d){return d||(Q("boolean"==typeof c,"missing or invalid endian"),Q(b+7<a.length,"Trying to read beyond buffer length")),S.read(a,b,c,52,8)}function w(a,b,c,d,e){e||(Q(void 0!==b&&null!==b,"missing value"),Q("boolean"==typeof d,"missing or invalid endian"),Q(void 0!==c&&null!==c,"missing offset"),Q(c+1<a.length,"trying to write beyond buffer length"),N(b,65535));var f=a.length;if(!(c>=f)){for(var g=0,h=Math.min(f-c,2);h>g;g++)a[c+g]=(b&255<<8*(d?g:1-g))>>>8*(d?g:1-g);return c+2}}function x(a,b,c,d,e){e||(Q(void 0!==b&&null!==b,"missing value"),Q("boolean"==typeof d,"missing or invalid endian"),Q(void 0!==c&&null!==c,"missing offset"),Q(c+3<a.length,"trying to write beyond buffer length"),N(b,4294967295));var f=a.length;if(!(c>=f)){for(var g=0,h=Math.min(f-c,4);h>g;g++)a[c+g]=b>>>8*(d?g:3-g)&255;return c+4}}function y(a,b,c,d,e){e||(Q(void 0!==b&&null!==b,"missing value"),Q("boolean"==typeof d,"missing or invalid endian"),Q(void 0!==c&&null!==c,"missing offset"),Q(c+1<a.length,"Trying to write beyond buffer length"),O(b,32767,-32768));var f=a.length;if(!(c>=f))return b>=0?w(a,b,c,d,e):w(a,65535+b+1,c,d,e),c+2}function z(a,b,c,d,e){e||(Q(void 0!==b&&null!==b,"missing value"),Q("boolean"==typeof d,"missing or invalid endian"),Q(void 0!==c&&null!==c,"missing offset"),Q(c+3<a.length,"Trying to write beyond buffer length"),O(b,2147483647,-2147483648));var f=a.length;if(!(c>=f))return b>=0?x(a,b,c,d,e):x(a,4294967295+b+1,c,d,e),c+4}function A(a,b,c,d,e){e||(Q(void 0!==b&&null!==b,"missing value"),Q("boolean"==typeof d,"missing or invalid endian"),Q(void 0!==c&&null!==c,"missing offset"),Q(c+3<a.length,"Trying to write beyond buffer length"),P(b,3.4028234663852886e38,-3.4028234663852886e38));var f=a.length;if(!(c>=f))return S.write(a,b,c,d,23,4),c+4}function B(a,b,c,d,e){e||(Q(void 0!==b&&null!==b,"missing value"),Q("boolean"==typeof d,"missing or invalid endian"),Q(void 0!==c&&null!==c,"missing offset"),Q(c+7<a.length,"Trying to write beyond buffer length"),P(b,1.7976931348623157e308,-1.7976931348623157e308));var f=a.length;if(!(c>=f))return S.write(a,b,c,d,52,8),c+8}function C(a){for(a=D(a).replace(V,"");a.length%4!==0;)a+="=";return a}function D(a){return a.trim?a.trim():a.replace(/^\s+|\s+$/g,"")}function E(a){return(Array.isArray||function(a){return"[object Array]"===Object.prototype.toString.call(a)})(a)}function F(a){return E(a)||d.isBuffer(a)||a&&"object"==typeof a&&"number"==typeof a.length}function G(a){return 16>a?"0"+a.toString(16):a.toString(16)}function H(a){for(var b=[],c=0;c<a.length;c++){var d=a.charCodeAt(c);if(127>=d)b.push(d);else{var e=c;d>=55296&&57343>=d&&c++;for(var f=encodeURIComponent(a.slice(e,c+1)).substr(1).split("%"),g=0;g<f.length;g++)b.push(parseInt(f[g],16))}}return b}function I(a){for(var b=[],c=0;c<a.length;c++)b.push(255&a.charCodeAt(c));return b}function J(a){for(var b,c,d,e=[],f=0;f<a.length;f++)b=a.charCodeAt(f),c=b>>8,d=b%256,e.push(d),e.push(c);return e}function K(a){return R.toByteArray(a)}function L(a,b,c,d){for(var e=0;d>e&&!(e+c>=b.length||e>=a.length);e++)b[e+c]=a[e];return e}function M(a){try{return decodeURIComponent(a)}catch(b){return String.fromCharCode(65533)}}function N(a,b){Q("number"==typeof a,"cannot write a non-number as a number"),Q(a>=0,"specified a negative value for writing an unsigned value"),Q(b>=a,"value is larger than maximum value for type"),Q(Math.floor(a)===a,"value has a fractional component")}function O(a,b,c){Q("number"==typeof a,"cannot write a non-number as a number"),Q(b>=a,"value larger than maximum allowed value"),Q(a>=c,"value smaller than minimum allowed value"),Q(Math.floor(a)===a,"value has a fractional component")}function P(a,b,c){Q("number"==typeof a,"cannot write a non-number as a number"),Q(b>=a,"value larger than maximum allowed value"),Q(a>=c,"value smaller than minimum allowed value")
}function Q(a,b){if(!a)throw new Error(b||"Failed assertion")}var R=a("base64-js"),S=a("ieee754");c.Buffer=d,c.SlowBuffer=d,c.INSPECT_MAX_BYTES=50,d.poolSize=8192;var T=function(){try{var a=new ArrayBuffer(0),b=new Uint8Array(a);return b.foo=function(){return 42},42===b.foo()&&"function"==typeof b.subarray&&0===new Uint8Array(1).subarray(1,1).byteLength}catch(c){return!1}}();d.isEncoding=function(a){switch(String(a).toLowerCase()){case"hex":case"utf8":case"utf-8":case"ascii":case"binary":case"base64":case"raw":case"ucs2":case"ucs-2":case"utf16le":case"utf-16le":return!0;default:return!1}},d.isBuffer=function(a){return!(null==a||!a._isBuffer)},d.byteLength=function(a,b){var c;switch(a=a.toString(),b||"utf8"){case"hex":c=a.length/2;break;case"utf8":case"utf-8":c=H(a).length;break;case"ascii":case"binary":case"raw":c=a.length;break;case"base64":c=K(a).length;break;case"ucs2":case"ucs-2":case"utf16le":case"utf-16le":c=2*a.length;break;default:throw new Error("Unknown encoding")}return c},d.concat=function(a,b){if(Q(E(a),"Usage: Buffer.concat(list[, length])"),0===a.length)return new d(0);if(1===a.length)return a[0];var c;if(void 0===b)for(b=0,c=0;c<a.length;c++)b+=a[c].length;var e=new d(b),f=0;for(c=0;c<a.length;c++){var g=a[c];g.copy(e,f),f+=g.length}return e},d.compare=function(a,b){Q(d.isBuffer(a)&&d.isBuffer(b),"Arguments must be Buffers");for(var c=a.length,e=b.length,f=0,g=Math.min(c,e);g>f&&a[f]===b[f];f++);return f!==g&&(c=a[f],e=b[f]),e>c?-1:c>e?1:0},d.prototype.write=function(a,b,c,d){if(isFinite(b))isFinite(c)||(d=c,c=void 0);else{var k=d;d=b,b=c,c=k}b=Number(b)||0;var l=this.length-b;c?(c=Number(c),c>l&&(c=l)):c=l,d=String(d||"utf8").toLowerCase();var m;switch(d){case"hex":m=e(this,a,b,c);break;case"utf8":case"utf-8":m=f(this,a,b,c);break;case"ascii":m=g(this,a,b,c);break;case"binary":m=h(this,a,b,c);break;case"base64":m=i(this,a,b,c);break;case"ucs2":case"ucs-2":case"utf16le":case"utf-16le":m=j(this,a,b,c);break;default:throw new Error("Unknown encoding")}return m},d.prototype.toString=function(a,b,c){var d=this;if(a=String(a||"utf8").toLowerCase(),b=Number(b)||0,c=void 0===c?d.length:Number(c),c===b)return"";var e;switch(a){case"hex":e=o(d,b,c);break;case"utf8":case"utf-8":e=l(d,b,c);break;case"ascii":e=m(d,b,c);break;case"binary":e=n(d,b,c);break;case"base64":e=k(d,b,c);break;case"ucs2":case"ucs-2":case"utf16le":case"utf-16le":e=p(d,b,c);break;default:throw new Error("Unknown encoding")}return e},d.prototype.toJSON=function(){return{type:"Buffer",data:Array.prototype.slice.call(this._arr||this,0)}},d.prototype.equals=function(a){return Q(d.isBuffer(a),"Argument must be a Buffer"),0===d.compare(this,a)},d.prototype.compare=function(a){return Q(d.isBuffer(a),"Argument must be a Buffer"),d.compare(this,a)},d.prototype.copy=function(a,b,c,d){var e=this;if(c||(c=0),d||0===d||(d=this.length),b||(b=0),d!==c&&0!==a.length&&0!==e.length){Q(d>=c,"sourceEnd < sourceStart"),Q(b>=0&&b<a.length,"targetStart out of bounds"),Q(c>=0&&c<e.length,"sourceStart out of bounds"),Q(d>=0&&d<=e.length,"sourceEnd out of bounds"),d>this.length&&(d=this.length),a.length-b<d-c&&(d=a.length-b+c);var f=d-c;if(100>f||!T)for(var g=0;f>g;g++)a[g+b]=this[g+c];else a._set(this.subarray(c,c+f),b)}},d.prototype.slice=function(a,b){var c=this.length;if(a=~~a,b=void 0===b?c:~~b,0>a?(a+=c,0>a&&(a=0)):a>c&&(a=c),0>b?(b+=c,0>b&&(b=0)):b>c&&(b=c),a>b&&(b=a),T)return d._augment(this.subarray(a,b));for(var e=b-a,f=new d(e,void 0,!0),g=0;e>g;g++)f[g]=this[g+a];return f},d.prototype.get=function(a){return console.log(".get() is deprecated. Access using array indexes instead."),this.readUInt8(a)},d.prototype.set=function(a,b){return console.log(".set() is deprecated. Access using array indexes instead."),this.writeUInt8(a,b)},d.prototype.readUInt8=function(a,b){return b||(Q(void 0!==a&&null!==a,"missing offset"),Q(a<this.length,"Trying to read beyond buffer length")),a>=this.length?void 0:this[a]},d.prototype.readUInt16LE=function(a,b){return q(this,a,!0,b)},d.prototype.readUInt16BE=function(a,b){return q(this,a,!1,b)},d.prototype.readUInt32LE=function(a,b){return r(this,a,!0,b)},d.prototype.readUInt32BE=function(a,b){return r(this,a,!1,b)},d.prototype.readInt8=function(a,b){if(b||(Q(void 0!==a&&null!==a,"missing offset"),Q(a<this.length,"Trying to read beyond buffer length")),!(a>=this.length)){var c=128&this[a];return c?-1*(255-this[a]+1):this[a]}},d.prototype.readInt16LE=function(a,b){return s(this,a,!0,b)},d.prototype.readInt16BE=function(a,b){return s(this,a,!1,b)},d.prototype.readInt32LE=function(a,b){return t(this,a,!0,b)},d.prototype.readInt32BE=function(a,b){return t(this,a,!1,b)},d.prototype.readFloatLE=function(a,b){return u(this,a,!0,b)},d.prototype.readFloatBE=function(a,b){return u(this,a,!1,b)},d.prototype.readDoubleLE=function(a,b){return v(this,a,!0,b)},d.prototype.readDoubleBE=function(a,b){return v(this,a,!1,b)},d.prototype.writeUInt8=function(a,b,c){return c||(Q(void 0!==a&&null!==a,"missing value"),Q(void 0!==b&&null!==b,"missing offset"),Q(b<this.length,"trying to write beyond buffer length"),N(a,255)),b>=this.length?void 0:(this[b]=a,b+1)},d.prototype.writeUInt16LE=function(a,b,c){return w(this,a,b,!0,c)},d.prototype.writeUInt16BE=function(a,b,c){return w(this,a,b,!1,c)},d.prototype.writeUInt32LE=function(a,b,c){return x(this,a,b,!0,c)},d.prototype.writeUInt32BE=function(a,b,c){return x(this,a,b,!1,c)},d.prototype.writeInt8=function(a,b,c){return c||(Q(void 0!==a&&null!==a,"missing value"),Q(void 0!==b&&null!==b,"missing offset"),Q(b<this.length,"Trying to write beyond buffer length"),O(a,127,-128)),b>=this.length?void 0:(a>=0?this.writeUInt8(a,b,c):this.writeUInt8(255+a+1,b,c),b+1)},d.prototype.writeInt16LE=function(a,b,c){return y(this,a,b,!0,c)},d.prototype.writeInt16BE=function(a,b,c){return y(this,a,b,!1,c)},d.prototype.writeInt32LE=function(a,b,c){return z(this,a,b,!0,c)},d.prototype.writeInt32BE=function(a,b,c){return z(this,a,b,!1,c)},d.prototype.writeFloatLE=function(a,b,c){return A(this,a,b,!0,c)},d.prototype.writeFloatBE=function(a,b,c){return A(this,a,b,!1,c)},d.prototype.writeDoubleLE=function(a,b,c){return B(this,a,b,!0,c)},d.prototype.writeDoubleBE=function(a,b,c){return B(this,a,b,!1,c)},d.prototype.fill=function(a,b,c){if(a||(a=0),b||(b=0),c||(c=this.length),Q(c>=b,"end < start"),c!==b&&0!==this.length){Q(b>=0&&b<this.length,"start out of bounds"),Q(c>=0&&c<=this.length,"end out of bounds");var d;if("number"==typeof a)for(d=b;c>d;d++)this[d]=a;else{var e=H(a.toString()),f=e.length;for(d=b;c>d;d++)this[d]=e[d%f]}return this}},d.prototype.inspect=function(){for(var a=[],b=this.length,d=0;b>d;d++)if(a[d]=G(this[d]),d===c.INSPECT_MAX_BYTES){a[d+1]="...";break}return"<Buffer "+a.join(" ")+">"},d.prototype.toArrayBuffer=function(){if("undefined"!=typeof Uint8Array){if(T)return new d(this).buffer;for(var a=new Uint8Array(this.length),b=0,c=a.length;c>b;b+=1)a[b]=this[b];return a.buffer}throw new Error("Buffer.toArrayBuffer not supported in this browser")};var U=d.prototype;d._augment=function(a){return a._isBuffer=!0,a._get=a.get,a._set=a.set,a.get=U.get,a.set=U.set,a.write=U.write,a.toString=U.toString,a.toLocaleString=U.toString,a.toJSON=U.toJSON,a.equals=U.equals,a.compare=U.compare,a.copy=U.copy,a.slice=U.slice,a.readUInt8=U.readUInt8,a.readUInt16LE=U.readUInt16LE,a.readUInt16BE=U.readUInt16BE,a.readUInt32LE=U.readUInt32LE,a.readUInt32BE=U.readUInt32BE,a.readInt8=U.readInt8,a.readInt16LE=U.readInt16LE,a.readInt16BE=U.readInt16BE,a.readInt32LE=U.readInt32LE,a.readInt32BE=U.readInt32BE,a.readFloatLE=U.readFloatLE,a.readFloatBE=U.readFloatBE,a.readDoubleLE=U.readDoubleLE,a.readDoubleBE=U.readDoubleBE,a.writeUInt8=U.writeUInt8,a.writeUInt16LE=U.writeUInt16LE,a.writeUInt16BE=U.writeUInt16BE,a.writeUInt32LE=U.writeUInt32LE,a.writeUInt32BE=U.writeUInt32BE,a.writeInt8=U.writeInt8,a.writeInt16LE=U.writeInt16LE,a.writeInt16BE=U.writeInt16BE,a.writeInt32LE=U.writeInt32LE,a.writeInt32BE=U.writeInt32BE,a.writeFloatLE=U.writeFloatLE,a.writeFloatBE=U.writeFloatBE,a.writeDoubleLE=U.writeDoubleLE,a.writeDoubleBE=U.writeDoubleBE,a.fill=U.fill,a.inspect=U.inspect,a.toArrayBuffer=U.toArrayBuffer,a};var V=/[^+\/0-9A-z]/g},{"base64-js":51,ieee754:52}],51:[function(a,b,c){var d="ABCDEFGHIJKLMNOPQRSTUVWXYZabcdefghijklmnopqrstuvwxyz0123456789+/";!function(a){"use strict";function b(a){var b=a.charCodeAt(0);return b===g?62:b===h?63:i>b?-1:i+10>b?b-i+26+26:k+26>b?b-k:j+26>b?b-j+26:void 0}function c(a){function c(a){j[l++]=a}var d,e,g,h,i,j;if(a.length%4>0)throw new Error("Invalid string. Length must be a multiple of 4");var k=a.length;i="="===a.charAt(k-2)?2:"="===a.charAt(k-1)?1:0,j=new f(3*a.length/4-i),g=i>0?a.length-4:a.length;var l=0;for(d=0,e=0;g>d;d+=4,e+=3)h=b(a.charAt(d))<<18|b(a.charAt(d+1))<<12|b(a.charAt(d+2))<<6|b(a.charAt(d+3)),c((16711680&h)>>16),c((65280&h)>>8),c(255&h);return 2===i?(h=b(a.charAt(d))<<2|b(a.charAt(d+1))>>4,c(255&h)):1===i&&(h=b(a.charAt(d))<<10|b(a.charAt(d+1))<<4|b(a.charAt(d+2))>>2,c(h>>8&255),c(255&h)),j}function e(a){function b(a){return d.charAt(a)}function c(a){return b(a>>18&63)+b(a>>12&63)+b(a>>6&63)+b(63&a)}var e,f,g,h=a.length%3,i="";for(e=0,g=a.length-h;g>e;e+=3)f=(a[e]<<16)+(a[e+1]<<8)+a[e+2],i+=c(f);switch(h){case 1:f=a[a.length-1],i+=b(f>>2),i+=b(f<<4&63),i+="==";break;case 2:f=(a[a.length-2]<<8)+a[a.length-1],i+=b(f>>10),i+=b(f>>4&63),i+=b(f<<2&63),i+="="}return i}var f="undefined"!=typeof Uint8Array?Uint8Array:Array,g="+".charCodeAt(0),h="/".charCodeAt(0),i="0".charCodeAt(0),j="a".charCodeAt(0),k="A".charCodeAt(0);a.toByteArray=c,a.fromByteArray=e}("undefined"==typeof c?this.base64js={}:c)},{}],52:[function(a,b,c){c.read=function(a,b,c,d,e){var f,g,h=8*e-d-1,i=(1<<h)-1,j=i>>1,k=-7,l=c?e-1:0,m=c?-1:1,n=a[b+l];for(l+=m,f=n&(1<<-k)-1,n>>=-k,k+=h;k>0;f=256*f+a[b+l],l+=m,k-=8);for(g=f&(1<<-k)-1,f>>=-k,k+=d;k>0;g=256*g+a[b+l],l+=m,k-=8);if(0===f)f=1-j;else{if(f===i)return g?0/0:1/0*(n?-1:1);g+=Math.pow(2,d),f-=j}return(n?-1:1)*g*Math.pow(2,f-d)},c.write=function(a,b,c,d,e,f){var g,h,i,j=8*f-e-1,k=(1<<j)-1,l=k>>1,m=23===e?Math.pow(2,-24)-Math.pow(2,-77):0,n=d?0:f-1,o=d?1:-1,p=0>b||0===b&&0>1/b?1:0;for(b=Math.abs(b),isNaN(b)||1/0===b?(h=isNaN(b)?1:0,g=k):(g=Math.floor(Math.log(b)/Math.LN2),b*(i=Math.pow(2,-g))<1&&(g--,i*=2),b+=g+l>=1?m/i:m*Math.pow(2,1-l),b*i>=2&&(g++,i/=2),g+l>=k?(h=0,g=k):g+l>=1?(h=(b*i-1)*Math.pow(2,e),g+=l):(h=b*Math.pow(2,l-1)*Math.pow(2,e),g=0));e>=8;a[c+n]=255&h,n+=o,h/=256,e-=8);for(g=g<<e|h,j+=e;j>0;a[c+n]=255&g,n+=o,g/=256,j-=8);a[c+n-o]|=128*p}},{}],53:[function(a,b){function c(){}var d=b.exports={};d.nextTick=function(){var a="undefined"!=typeof window&&window.setImmediate,b="undefined"!=typeof window&&window.postMessage&&window.addEventListener;if(a)return function(a){return window.setImmediate(a)};if(b){var c=[];return window.addEventListener("message",function(a){var b=a.source;if((b===window||null===b)&&"process-tick"===a.data&&(a.stopPropagation(),c.length>0)){var d=c.shift();d()}},!0),function(a){c.push(a),window.postMessage("process-tick","*")}}return function(a){setTimeout(a,0)}}(),d.title="browser",d.browser=!0,d.env={},d.argv=[],d.on=c,d.addListener=c,d.once=c,d.off=c,d.removeListener=c,d.removeAllListeners=c,d.emit=c,d.binding=function(){throw new Error("process.binding is not supported")},d.cwd=function(){return"/"},d.chdir=function(){throw new Error("process.chdir is not supported")}},{}]},{},[2])(2)});